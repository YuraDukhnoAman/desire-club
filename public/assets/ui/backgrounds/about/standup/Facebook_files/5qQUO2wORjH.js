;/*FB_PKG_DELIM*/

__d("ArmadilloCutoverClientFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("699");b=d("FalcoLoggerInternal").create("armadillo_cutover_client",a);e=b;g["default"]=e}),98);
__d("CometFriendNotificationsStateChangeSubscription_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="9754477301332178"}),null);
__d("CometFriendNotificationsStateChangeSubscription.graphql",["CometFriendNotificationsStateChangeSubscription_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a={defaultValue:null,kind:"LocalArgument",name:"environment"},c={defaultValue:null,kind:"LocalArgument",name:"input"},d=[{alias:null,args:[{kind:"Variable",name:"data",variableName:"input"}],concreteType:"NotificationStateChangeSubscribeResponsePayload",kind:"LinkedField",name:"notification_state_change_subscribe",plural:!1,selections:[{alias:null,args:null,concreteType:"Notification",kind:"LinkedField",name:"notification",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"seen_state",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"notif_id",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:[{kind:"Variable",name:"environment",variableName:"environment"}],kind:"ScalarField",name:"notifications_unseen_count",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"last_update_timestamp",storageKey:null}],storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[a,c],kind:"Fragment",metadata:null,name:"CometFriendNotificationsStateChangeSubscription",selections:d,type:"Subscription",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[c,a],kind:"Operation",name:"CometFriendNotificationsStateChangeSubscription",selections:d},params:{id:b("CometFriendNotificationsStateChangeSubscription_facebookRelayOperation"),metadata:{subscriptionName:"notification_state_change_subscribe"},name:"CometFriendNotificationsStateChangeSubscription",operationKind:"subscription",text:null}}}();e.exports=a}),null);
__d("FriendingCometSubscriptionToastHelper",["react","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react"),j=c("requireDeferred")("FriendingCometConfirmedFriendRequestToast.react").__setRef("FriendingCometSubscriptionToastHelper"),k=c("requireDeferred")("FriendingCometFriendRequestToast.react").__setRef("FriendingCometSubscriptionToastHelper"),l=new Set(),m={};function a(a,b){var c,d,e=a==null?void 0:a.friend_request_receive_subscribe,f=e==null||(c=e.notif)==null?void 0:c.seen_state,g=e==null||(d=e.notif)==null?void 0:d.notif_id;f==="UNSEEN_AND_UNREAD"&&g!=null&&(l.add(g),k.onReadyImmediately(function(c){if(!l.has(g))return;l["delete"](g);var d=b.push(i.jsx(c,{onCloseClick:function(){return b.expire(d)},response:a}),5e3);m[g]=d}))}function b(a,b){var c,d,e=a==null?void 0:a.friend_request_confirm_subscribe,f=e==null||(c=e.notif)==null?void 0:c.seen_state,g=e==null||(d=e.notif)==null?void 0:d.notif_id;f==="UNSEEN_AND_UNREAD"&&g!=null&&(l.add(g),j.onReadyImmediately(function(c){if(!l.has(g))return;l["delete"](g);var d=b.push(i.jsx(c,{onCloseClick:function(){return b.expire(d)},response:a}),5e3);m[g]=d}))}function e(a,b,c){var d=c.getState();a!=="UNSEEN_AND_UNREAD"&&b in m&&((a=d[m[b]])==null?void 0:a.shown)!==!0&&(c["delete"](m[b]),delete m[b],l["delete"](b))}g.pushFriendingCometToast=a;g.pushFriendingConfirmedCometToast=b;g.deleteToastIfSeen=e}),98);
__d("CometFriendNotificationsStateChangeSubscription",["CometFriendNotificationsStateChangeSubscription.graphql","CometRelay","FriendingCometSubscriptionToastHelper"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h!==void 0?h:h=b("CometFriendNotificationsStateChangeSubscription.graphql");function a(a,b){var c=function(a){var c;a=a==null||(c=a.notification_state_change_subscribe)==null?void 0:c.notification;var e=a==null?void 0:a.seen_state;a=a==null?void 0:a.notif_id;e!=null&&a!=null&&d("FriendingCometSubscriptionToastHelper").deleteToastIfSeen(e,a,b)};return d("CometRelay").requestSubscription(a,{onNext:c,subscription:i,variables:{environment:"FRIENDS_TAB",input:{environment:"FRIENDS_TAB"}}})}g.subscription=i;g.subscribeToFriendNotifs=a}),98);
__d("EncryptedBackupdDYIFileSaver",["requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("file-saver").__setRef("EncryptedBackupdDYIFileSaver");function a(a,b){h.onReadyImmediately(function(c){c=c.saveAs;c(b,a)})}g.saveFile=a}),98);
__d("FDSMinusCircleOutline20Icon",["cr:15284"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=b("cr:15284")}),98);
__d("FDSMinusCircleOutline20PNGIcon.react",["ix","fbicon"],(function(a,b,c,d,e,f,g,h){"use strict";a=d("fbicon")._(h("518013"),20);b=a;g["default"]=b}),98);
__d("FriendingCometConfirmedFriendRequestToast.react",["fbt","CometNotificationsListItem.react","CometNotificationsMutationLogger","CometNotificationsUpdateSeenStateMutation","CometRelay","CometToastCard.react","react","react-compiler-runtime","recoverableViolation"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react"));b=i;b.useCallback;var k=b.useRef,l="MARK_SEEN",m="comet_toast",n="beeper";function a(a){var b,e,f=d("react-compiler-runtime").c(18),g=a.onCloseClick;a=a.response;a=a==null?void 0:a.friend_request_confirm_subscribe;var i=a==null?void 0:a.notif,p=i==null?void 0:i.id,q=i==null?void 0:i.seen_state,r=a==null?void 0:a.new_friend;a=a==null||(b=a.viewer)==null?void 0:b.actor;var s=i==null||(e=i.body)==null?void 0:e.text,t=k(!1),u=d("CometRelay").useRelayEnvironment(),v;f[0]!==u||f[1]!==p||f[2]!==q?(v=function(){if(p==null||q!=="UNSEEN_AND_UNREAD"||t.current===!0)return;d("CometNotificationsUpdateSeenStateMutation").CometNotificationsUpdateSeenStateMutation(u,{environment:"FRIENDS_TAB",input:{environment:"FRIENDS_TAB",is_comet:!0,last_notif_sync_time:0,notif_ids:[p],source:m,update_type:l}},{mutationLogger:d("CometNotificationsMutationLogger").notificationMarkAsSeenStart,onError:o,onSuccess:function(){t.current=!0},updater:function(a){d("CometNotificationsUpdateSeenStateMutation").updateSingleNotifReadState(a,p)}})},f[0]=u,f[1]=p,f[2]=q,f[3]=v):v=f[3];v=v;if(r==null||i==null)return null;f[4]!==p||f[5]!==s?(r=p==null||s==null?null:{id:p,text:s},f[4]=p,f[5]=s,f[6]=r):r=f[6];s=r;f[7]!==a||f[8]!==i||f[9]!==g?(r=j.jsx("div",{role:"grid",children:j.jsx(c("CometNotificationsListItem.react"),{actor:a,loggerContext:n,notification:i,onClick:g})}),f[7]=a,f[8]=i,f[9]=g,f[10]=r):r=f[10];f[11]===Symbol["for"]("react.memo_cache_sentinel")?(a=h._(/*BTDS*/"\u041d\u043e\u0432\u043e\u0435 \u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u0435"),f[11]=a):a=f[11];f[12]!==s||f[13]!==v||f[14]!==g||f[15]!==r||f[16]!==a?(i=j.jsx(c("CometToastCard.react"),{accessibilityAnnouncement:s,content:r,headline:a,onCloseClick:g,onMouseEnter:v}),f[12]=s,f[13]=v,f[14]=g,f[15]=r,f[16]=a,f[17]=i):i=f[17];return i}function o(a){c("recoverableViolation")("Failed to mark friend confirmed notification as seen in the toast: ","growth_friending",{error:a})}g["default"]=a}),226);
__d("FriendingCometFriendRequestToast.react",["fbt","CometNotificationsListItem.react","CometNotificationsMutationLogger","CometNotificationsUpdateSeenStateMutation","CometRelay","CometToastCard.react","react","react-compiler-runtime","recoverableViolation"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react"));b=i;b.useCallback;var k=b.useRef,l="MARK_SEEN",m="comet_toast",n="beeper";function a(a){var b,e,f=d("react-compiler-runtime").c(18),g=a.onCloseClick;a=a.response;a=a==null?void 0:a.friend_request_receive_subscribe;var i=a==null?void 0:a.notif,p=i==null?void 0:i.id,q=i==null?void 0:i.seen_state;a=a==null||(b=a.viewer)==null?void 0:b.actor;var r=i==null||(e=i.body)==null?void 0:e.text,s=k(!1),t=d("CometRelay").useRelayEnvironment(),u;f[0]!==t||f[1]!==p||f[2]!==q?(u=function(){if(p==null||q!=="UNSEEN_AND_UNREAD"||s.current===!0)return;d("CometNotificationsUpdateSeenStateMutation").CometNotificationsUpdateSeenStateMutation(t,{environment:"FRIENDS_TAB",input:{environment:"FRIENDS_TAB",is_comet:!0,last_notif_sync_time:0,notif_ids:[p],source:m,update_type:l}},{mutationLogger:d("CometNotificationsMutationLogger").notificationMarkAsSeenStart,onError:o,onSuccess:function(){s.current=!0},updater:function(a){d("CometNotificationsUpdateSeenStateMutation").updateSingleNotifSeenState(a,p),d("CometNotificationsUpdateSeenStateMutation").lowerBadgeCountByOne(a)}})},f[0]=t,f[1]=p,f[2]=q,f[3]=u):u=f[3];u=u;if(i==null)return null;var v;f[4]!==p||f[5]!==r?(v=p==null||r==null?null:{id:p,text:r},f[4]=p,f[5]=r,f[6]=v):v=f[6];r=v;f[7]!==a||f[8]!==i||f[9]!==g?(v=j.jsx("div",{role:"grid",children:j.jsx(c("CometNotificationsListItem.react"),{actor:a,loggerContext:n,notification:i,onClick:g})}),f[7]=a,f[8]=i,f[9]=g,f[10]=v):v=f[10];f[11]===Symbol["for"]("react.memo_cache_sentinel")?(a=h._(/*BTDS*/"\u041d\u043e\u0432\u043e\u0435 \u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u0435"),f[11]=a):a=f[11];f[12]!==r||f[13]!==u||f[14]!==g||f[15]!==v||f[16]!==a?(i=j.jsx(c("CometToastCard.react"),{accessibilityAnnouncement:r,content:v,headline:a,onCloseClick:g,onMouseEnter:u}),f[12]=r,f[13]=u,f[14]=g,f[15]=v,f[16]=a,f[17]=i):i=f[17];return i}function o(a){c("recoverableViolation")("Failed to mark friend notification as seen in the toast: ","growth_friending",{error:a})}g["default"]=a}),226);
__d("LSBumpE2EEMetadataThread",["LSCancelTaskByQueueName","LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=new c.Map(),d[0].set("bump_timestamp_ms",a[1]),d[0].set("thread_key",a[0]),d[0].set("bumped_by_local_device_send",a[2]),d[0].set("tam_thread_subtype",c.i64.cast([0,0])),d[0].set("wa_jid",void 0),d[0].set("message_ephemeral_duration_in_sec",c.i64.cast([0,0])),d[0].set("message_product_type",void 0),d[0].set("is_message_deletion",!1),d[0].set("is_unbump",a[3]),d[1]=d[0].get("thread_key"),c.storedProcedure(b("LSCancelTaskByQueueName"),c.i64.to_string(d[1]),c.i64.cast([0,389]))},function(e){return d[2]=new c.Map(),d[2].set("bump_timestamp_ms",a[1]),d[2].set("thread_key",a[0]),d[2].set("bumped_by_local_device_send",a[2]),d[2].set("tam_thread_subtype",c.i64.cast([0,0])),d[2].set("wa_jid",void 0),d[2].set("message_ephemeral_duration_in_sec",c.i64.cast([0,0])),d[2].set("message_product_type",void 0),d[2].set("is_message_deletion",!1),d[2].set("is_unbump",a[3]),d[3]=d[2].get("thread_key"),d[4]=c.toJSON(d[2]),c.storedProcedure(b("LSIssueNewTask"),c.i64.to_string(d[3]),c.i64.cast([0,389]),d[4],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxBumpE2EEMetadataThreadStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSEncryptedBackupsOnboardingDecision",[],(function(a,b,c,d,e,f){a=Object.freeze({FAILURE:-1,NO_DECISION_MADE:0,BACKUP_CREATED:1,STORE_ON_DEVICE_ONLY:2});f["default"]=a}),66);
__d("LSEncryptedBackupsVirtualDeviceType",[],(function(a,b,c,d,e,f){a=Object.freeze({OFFLINE:1,HSM:2,BLOCK_STORE:3,KEYCHAIN:5,ICLOUD_KVS:6,GOOGLE_DRIVE:7,CLOUDKIT:8,ICLOUD_DRIVE:9,PASSKEY:10,ICLOUD_KEYCHAIN:11,GOOGLE_ONE_AUTO_BACKUP:12,SECURITY_QUESTION_HSM:13,TRUSTED_CONTACT:14});f["default"]=a}),66);
__d("LSIssueAttachmentBackupTask",["LSArrayGetObjectAt","LSBase64Encode.nop","LSGetBlobFromString.nop","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSIssueNewTask","LSLogMebClientEvent.nop","LSOcmfClientMap.nop","LSQplAnnotateString.nop","LSQplMarkEnd.nop","LSQplMarkPoint.nop","LSQplStartTrace.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure] Beginning execution."),a[5]!==void 0?c.resolve(d[1]=a[5]):c.sequence([function(a){return d[27]=c.i64.random(),d[28]=c.i64.to_string(d[27]),d[28]!==void 0?c.nativeOperation(b("LSQplStartTrace.nop"),c.i64.cast([0,637738637]),d[28],!0,void 0):c.resolve()},function(a){return d[1]=d[28]}])},function(a){return d[1]!==void 0?c.nativeOperation(b("LSQplMarkPoint.nop"),c.i64.cast([0,637738637]),d[1],"LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure_start"):c.resolve()},function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,e){var f=a.done;a=a.value;return f?(f=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,c.i64.cast([0,1]),void 0,void 0,void 0,void 0,void 0,void 0,void 0,c.i64.cast([0,20]),void 0,void 0],d[2]=f[0],d[3]=f[1],d[4]=f[2],d[5]=f[3],d[6]=f[4],d[7]=f[5],d[8]=f[6],d[9]=f[7],d[10]=f[8],d[11]=f[9],d[12]=f[10],d[13]=f[11],d[14]=f[12],d[15]=f[13],d[16]=f[14],d[17]=f[15],d[18]=f[16],d[19]=f[17],f):(e=a.item,c.sequence([function(a){return d[32]=e.backupTenancy,d[31]=e.encryptionVersion,d[27]=void 0,c.i64.neq(d[27],void 0)?c.resolve(d[28]=d[27]):c.sequence([function(a){return d[33]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[34]=a[0],a})},function(a){return d[34]?d[43]=(d[33].push(c.i64.cast([0,0])),d[33]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[35]=a[0],a})},function(a){return d[35]?d[43]=(d[33].push(c.i64.cast([0,2])),d[33]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[36]=a[0],a})},function(a){return d[36]?d[43]=(d[33].push(c.i64.cast([0,3])),d[33]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[37]=a[0],a})},function(a){return d[37]?d[43]=(d[33].push(c.i64.cast([0,4])),d[33]):0,d[38]=c.createArray(),d[39]=c.i64.of_int32(d[33].length),c.i64.gt(d[39],c.i64.cast([0,0]))?c.loopAsync(d[39],function(a){return d[43]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[33],d[43]).then(function(a){return a=a,d[44]=a[0],d[45]=a[1],a})},function(a){return d[46]=(d[38].push(d[44]),d[38])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[43]=c.createArray(),d[44]=c.i64.of_int32(d[38].length),c.i64.gt(d[44],c.i64.cast([0,0]))?c.loopAsync(d[44],function(a){return d[46]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[38],d[46]).then(function(a){return a=a,d[47]=a[0],d[48]=a[1],a})},function(a){return d[49]=(d[43].push(c.i64.to_string(d[47])),d[43])}])}):c.resolve()},function(a){return d[45]=d[43].join(","),d[40]=d[45]}])},function(a){return d[38].some(function(a){return c.i64.eq(d[31],a)})?d[41]=d[31]:d[41]=void 0,c.i64.neq(d[41],void 0)?d[42]=d[41]:d[42]=void 0,d[28]=d[42]}])},function(a){return c.i64.neq(d[28],void 0)?d[29]=d[28]:d[29]=c.i64.cast([0,0]),c.i64.neq(d[32],void 0)?d[30]=d[32]:d[30]=c.i64.cast([0,1]),a=[e.backupId,e.deviceId,e.mailboxRootKeyBlob,e.ocmfClientStateBlob,void 0,void 0,d[29],d[30],e.epochAuthPublicKeyBlob,e.epochAuthPrivateKeyBlob,e.devicePublicKeyBlob,e.devicePrivateKeyBlob,e.epochStoragePublicKeyBlob,e.epochStoragePrivateKeyBlob,e.obliviousValidationTokenBlob,e.authorityLevel,void 0,void 0],d[2]=a[0],d[3]=a[1],d[4]=a[2],d[5]=a[3],d[6]=a[4],d[7]=a[5],d[8]=a[6],d[9]=a[7],d[10]=a[8],d[11]=a[9],d[12]=a[10],d[13]=a[11],d[14]=a[12],d[15]=a[13],d[16]=a[14],d[17]=a[15],d[18]=a[16],d[19]=a[17]}]))})},function(e){return c.blobs.neq(d[5],void 0)?c.i64.neq(d[3],void 0)?(d[27]=c.i64.to_string(d[2]),d[27]!==void 0?c.sequence([function(e){return d[28]=c.createArray(),d[63]=(d[28].push(d[27]),d[28]),d[63]=(d[28].push(a[0]),d[28]),d[29]=c.toJSON(d[28]),c.nativeOperation(b("LSGetBlobFromString.nop"),d[29]).then(function(a){return a=a,d[30]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF9rZXlfc2NvcGU="),d[30]).then(function(a){return a=a,d[31]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[31]).then(function(a){return a=a,d[32]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[32]).then(function(a){return a=a,d[33]=a[0],a})},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),d[27]).then(function(a){return a=a,d[34]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("bWFpbGJveF9pZF9zY29wZQ=="),d[34]).then(function(a){return a=a,d[35]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[35]).then(function(a){return a=a,d[36]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[36]).then(function(a){return a=a,d[37]=a[0],a})},function(e){return d[38]=new c.Map(),d[38].set("attachment_index_key",d[33]==null?"":d[33]),d[38].set("delivery_object_id",a[0]),d[38].set("device_id",d[3]),d[38].set("mailbox_partial_id",d[37]==null?"":d[37]),d[38].set("media_type",a[2]),d[38].set("product_type",a[1]),d[38].set("trace_id",d[1]),d[39]=new c.Map(),d[39].set("otid",a[3]),d[39].set("server_thread_key",a[6]),d[39].set("timestamp",void 0),c.nativeOperation(b("LSGetBlobFromString.nop"),a[3]).then(function(a){return a=a,d[40]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF90b2tlbl9zYWx0X3Njb3Bl"),d[40]).then(function(a){return a=a,d[41]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[41]).then(function(a){return a=a,d[42]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[42]).then(function(a){return a=a,d[43]=a[0],a})},function(e){return d[38].set("salt_partial_id",d[43]==null?"":d[43]),c.nativeOperation(b("LSGetBlobFromString.nop"),a[4]).then(function(a){return a=a,d[44]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("dGhyZWFkX2lkX3Njb3Bl"),d[44]).then(function(a){return a=a,d[45]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[45]).then(function(a){return a=a,d[46]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[46]).then(function(a){return a=a,d[47]=a[0],a})},function(e){return d[38].set("thread_partial_id",d[47]==null?"":d[47]),c.nativeOperation(b("LSGetBlobFromString.nop"),a[3]).then(function(a){return a=a,d[48]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("bWVzc2FnZV9pZF9zY29wZQ=="),d[48]).then(function(a){return a=a,d[49]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[49]).then(function(a){return a=a,d[50]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[50]).then(function(a){return a=a,d[51]=a[0],a})},function(e){return d[38].set("message_partial_id",d[51]==null?"":d[51]),d[52]=c.createArray(),d[63]=(d[52].push(a[3]),d[52]),d[63]=(d[52].push(a[0]),d[52]),d[53]=c.toJSON(d[52]),d[38].set("raw_identifiers",d[39]),d[38].set("backup_id",d[27]),d[38].set("thread_id",a[4]),c.nativeOperation(b("LSGetBlobFromString.nop"),d[53]).then(function(a){return a=a,d[54]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF90b2tlbl9zYWx0X3Njb3Bl"),d[54]).then(function(a){return a=a,d[55]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[55]).then(function(a){return a=a,d[56]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[56]).then(function(a){return a=a,d[57]=a[0],a})},function(a){return d[38].set("salt_partial_access_token",d[57]==null?"":d[57]),c.nativeOperation(b("LSGetBlobFromString.nop"),d[29]).then(function(a){return a=a,d[58]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF9rZXlfc2FsdF9zY29wZQ=="),d[58]).then(function(a){return a=a,d[59]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[59]).then(function(a){return a=a,d[60]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[60]).then(function(a){return a=a,d[61]=a[0],a})},function(a){return d[38].set("salt_partial_attachment_index_key",d[61]==null?"":d[61]),d[1]!==void 0?c.nativeOperation(b("LSQplMarkEnd.nop"),c.i64.cast([0,637738637]),d[1],!0):c.resolve()},function(a){return d[62]=c.toJSON(d[38]),c.storedProcedure(b("LSIssueNewTask"),"encrypted_backups_attachment_upload",c.i64.cast([0,50012]),d[62],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}]):c.sequence([function(a){return d[29]="Missing backup_id for IssueAttachmentBackupTask",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure] ","",d[29]].join("")),d[28]=c.createArray(),void 0!==void 0?d[31]=(d[28].push(void 0),d[28]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure",d[29],d[28],c.i64.cast([0,3]))},function(a){return d[30]=["LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure",".","missing_backup_id"].join(""),d[1]!==void 0?d[30]!==void 0?c.nativeOperation(b("LSQplAnnotateString.nop"),c.i64.cast([0,637738637]),d[1],"error",d[30]):c.resolve():c.resolve()},function(a){return d[1]!==void 0?c.nativeOperation(b("LSQplMarkEnd.nop"),c.i64.cast([0,637738637]),d[1],!1):c.resolve()}])):c.sequence([function(a){return d[28]="Missing device_id for IssueAttachmentBackupTask",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure] ","",d[28]].join("")),d[27]=c.createArray(),void 0!==void 0?d[30]=(d[27].push(void 0),d[27]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure",d[28],d[27],c.i64.cast([0,3]))},function(a){return d[29]=["LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure",".","missing_device_id"].join(""),d[1]!==void 0?d[29]!==void 0?c.nativeOperation(b("LSQplAnnotateString.nop"),c.i64.cast([0,637738637]),d[1],"error",d[29]):c.resolve():c.resolve()},function(a){return d[1]!==void 0?c.nativeOperation(b("LSQplMarkEnd.nop"),c.i64.cast([0,637738637]),d[1],!1):c.resolve()}]):c.sequence([function(a){return d[28]="Missing ocmf_client_state_blob for IssueAttachmentBackupTask",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure] ","",d[28]].join("")),d[27]=c.createArray(),void 0!==void 0?d[30]=(d[27].push(void 0),d[27]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure",d[28],d[27],c.i64.cast([0,3]))},function(a){return d[29]=["LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure",".","missing_ocmf_client_state_blob"].join(""),d[1]!==void 0?d[29]!==void 0?c.nativeOperation(b("LSQplAnnotateString.nop"),c.i64.cast([0,637738637]),d[1],"error",d[29]):c.resolve():c.resolve()},function(a){return d[1]!==void 0?c.nativeOperation(b("LSQplMarkEnd.nop"),c.i64.cast([0,637738637]),d[1],!1):c.resolve()}])},function(a){return d[21]=c.i64.of_float(Date.now()),d[22]=c.i64.random(),d[24]="Finishing execution. Execution time: ",d[25]=c.i64.to_string(c.i64.sub(d[21],d[0])),d[26]=" ms",d[23]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure] ",d[23],d[24],d[23],d[25],d[23],d[26]].join("")),c.i64.eq(c.i64.mod_(d[22],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[27]=",",d[28]=c.createArray(),void 0!==void 0?d[29]=(d[28].push(void 0),d[28]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure",[d[24],d[27],d[25],d[27],d[26]].join(""),d[28],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state"];e.exports=a}),null);
__d("LSIssueThreadRemove",["LSArrayGetObjectAt","LSIsEncryptionVersionSecure","LSIssueNewTaskAndGetTaskID","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][issueThreadRemove] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[15]=new c.Map(),d[15].set("error_msg","Expected a nonempty query result"),d[15].set("code",c.i64.cast([0,3])),d[15].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[16]=c.createArray(),d[17]=(d[16].push(d[15]),d[16]),e=[void 0,d[16]],d[2]=e[0],d[3]=e[1]):(b=a.item,d[15]=new c.Map(),d[15].set("backup_id",b.backupId),d[15].set("device_public_key_blob",b.devicePublicKeyBlob),d[15].set("device_private_key_blob",b.devicePrivateKeyBlob),d[15].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[15].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[15].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[15].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[15].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[15].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[15].set("orf_client_state_v2_blob",void 0),d[15].set("orf_v2_authority_level",void 0),d[15].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[15].set("device_id",b.deviceId),d[15].set("backup_tenancy",b.backupTenancy),d[15].set("encryption_version",b.encryptionVersion),d[15].set("revision_version",b.revisionVersion),d[15].set("initialize_restore_result",void 0),d[15].set("device_creation_timestamp_sec",void 0),d[15].set("authority_level",b.authorityLevel),e=[d[15],void 0],d[2]=e[0],d[3]=e[1])})},function(e){return d[5]=new c.Map(),d[5].set("value",d[2]),d[5].set("errors",d[3]),d[6]=d[5].get("value"),d[6]!==void 0?c.sequence([function(e){return d[15]=d[6].get("backup_id"),d[16]=d[6].get("device_public_key_blob"),d[17]=d[6].get("device_private_key_blob"),d[18]=d[6].get("epoch_storage_public_key_blob"),d[19]=d[6].get("epoch_storage_private_key_blob"),d[20]=d[6].get("epoch_auth_public_key_blob"),d[21]=d[6].get("epoch_auth_private_key_blob"),d[22]=d[6].get("mailbox_root_key_blob"),d[23]=d[6].get("ocmf_client_state_blob"),d[24]=d[6].get("orf_client_state_v2_blob"),d[25]=d[6].get("orf_v2_authority_level"),d[26]=d[6].get("oblivious_validation_token_blob"),d[27]=d[6].get("device_id"),d[28]=d[6].get("backup_tenancy"),d[29]=d[6].get("encryption_version"),d[30]=d[6].get("revision_version"),d[31]=d[6].get("initialize_restore_result"),d[32]=d[6].get("device_creation_timestamp_sec"),d[33]=d[6].get("authority_level"),c.i64.neq(d[27],void 0)?c.sequence([function(a){return d[36]=void 0,c.i64.neq(d[36],void 0)?c.resolve(d[37]=d[36]):c.sequence([function(a){return d[43]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[44]=a[0],a})},function(a){return d[44]?d[53]=(d[43].push(c.i64.cast([0,0])),d[43]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[45]=a[0],a})},function(a){return d[45]?d[53]=(d[43].push(c.i64.cast([0,2])),d[43]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[46]=a[0],a})},function(a){return d[46]?d[53]=(d[43].push(c.i64.cast([0,3])),d[43]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[47]=a[0],a})},function(a){return d[47]?d[53]=(d[43].push(c.i64.cast([0,4])),d[43]):0,d[48]=c.createArray(),d[49]=c.i64.of_int32(d[43].length),c.i64.gt(d[49],c.i64.cast([0,0]))?c.loopAsync(d[49],function(a){return d[53]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[43],d[53]).then(function(a){return a=a,d[54]=a[0],d[55]=a[1],a})},function(a){return d[56]=(d[48].push(d[54]),d[48])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[53]=c.createArray(),d[54]=c.i64.of_int32(d[48].length),c.i64.gt(d[54],c.i64.cast([0,0]))?c.loopAsync(d[54],function(a){return d[56]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[48],d[56]).then(function(a){return a=a,d[57]=a[0],d[58]=a[1],a})},function(a){return d[59]=(d[53].push(c.i64.to_string(d[57])),d[53])}])}):c.resolve()},function(a){return d[55]=d[53].join(","),d[50]=d[55]}])},function(a){return d[48].some(function(a){return c.i64.eq(d[29],a)})?d[51]=d[29]:d[51]=void 0,c.i64.neq(d[51],void 0)?d[52]=d[51]:d[52]=void 0,d[37]=d[52]}])},function(e){return c.i64.neq(d[37],void 0)?d[38]=d[37]:d[38]=c.i64.cast([0,0]),c.i64.neq(d[28],void 0)?d[39]=d[28]:d[39]=c.i64.cast([0,1]),d[40]=c.i64.of_float(Date.now()),c.storedProcedure(b("LSIssueNewTaskAndGetTaskID"),["eb_upload",":",a[0]].join(""),c.i64.cast([0,50026]),"",void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),c.i64.cast([0,93]),void 0,c.i64.le(c.i64.cast([0,0]),c.i64.cast([0,0]))?c.i64.cast([0,0]):c.i64.add(d[40],c.i64.sub(c.i64.cast([0,0]),c.i64.mod_(d[40],c.i64.cast([0,0])))),c.i64.cast([0,0])).then(function(a){return a=a,d[41]=a[0],a})},function(b){return c.db.table(177).add({pk:void 0,pendingBackupTaskId:d[41],actionType:c.i64.cast([0,2]),contentType:c.i64.cast([0,2]),backupStatus:c.i64.cast([0,1]),listKey:a[0],uniqueKey:a[0],sortKey:a[1],persistentId:"",isInstamadillo:!1,lsTraceId:a[3],error:a[4]})},function(b){return c.i64.eq(c.i64.cast([0,2]),c.i64.cast([0,1]))?c.i64.eq(c.i64.cast([0,2]),c.i64.cast([0,1]))?(d[43]=c.createArray(),d[45]=(d[43].push("Successfully issued message backup task. act thread id = "),d[43]),d[45]=(d[43].push(a[0]),d[43]),d[45]=(d[43].push(", otid = "),d[43]),d[45]=(d[43].push(a[0]),d[43]),d[44]=d[43].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueThreadRemove] ","",d[44]].join("")),c.resolve()):(d[43]=c.createArray(),d[45]=(d[43].push("Successfully issued message remove task. act thread id = "),d[43]),d[45]=(d[43].push(a[0]),d[43]),d[45]=(d[43].push(", otid = "),d[43]),d[45]=(d[43].push(a[0]),d[43]),d[44]=d[43].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueThreadRemove] ","",d[44]].join("")),c.resolve()):(d[43]=c.createArray(),d[45]=(d[43].push("Successfully issued thread remove task. act thread id = "),d[43]),d[45]=(d[43].push(a[0]),d[43]),d[44]=d[43].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueThreadRemove] ","",d[44]].join("")),c.resolve())},function(a){return d[42]=new c.Map(),d[42].set("task_id",d[41]),a=[d[42],void 0],d[34]=a[0],d[35]=a[1]}]):c.sequence([function(b){return d[36]=c.createArray(),d[39]=(d[36].push("Skipping thread remove since EB is disabled. act thread id = "),d[36]),d[39]=(d[36].push(a[0]),d[36]),d[37]=d[36].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueThreadRemove] ","",d[37]].join("")),c.resolve()},function(a){return d[38]=new c.Map(),d[38].set("error_code",c.i64.cast([0,24])),d[38].set("stored_procedure","LSEncryptedBackupsIssueThreadRemoveStoredProcedure"),d[38].set("error_message",""),a=[void 0,d[38]],d[34]=a[0],d[35]=a[1]}])},function(a){return a=[d[34],d[35]],d[7]=a[0],d[8]=a[1],a}]):c.sequence([function(b){return d[15]=d[5].get("errors"),d[16]=d[5].get("errors"),d[17]=c.createArray(),d[20]=(d[17].push("Skipping thread remove since EB is disabled. act thread id = "),d[17]),d[20]=(d[17].push(a[0]),d[17]),d[18]=d[17].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueThreadRemove] ","",d[18]].join("")),c.resolve()},function(a){return d[19]=new c.Map(),d[19].set("error_code",c.i64.cast([0,1])),d[19].set("stored_procedure","LSEncryptedBackupsIssueThreadRemoveStoredProcedure"),d[19].set("error_message",""),a=[void 0,d[19]],d[7]=a[0],d[8]=a[1]}])},function(a){return d[9]=c.i64.of_float(Date.now()),d[10]=c.i64.random(),d[12]="Finishing execution. Execution time: ",d[13]=c.i64.to_string(c.i64.sub(d[9],d[0])),d[14]=" ms",d[11]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueThreadRemove] ",d[11],d[12],d[11],d[13],d[11],d[14]].join("")),c.i64.eq(c.i64.mod_(d[10],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[15]=",",d[16]=c.createArray(),void 0!==void 0?d[17]=(d[16].push(void 0),d[16]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"issueThreadRemove",[d[12],d[15],d[13],d[15],d[14]].join(""),d[16],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[7],d[8]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsIssueThreadRemoveStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state","pending_backups_context_v2"];e.exports=a}),null);
__d("LSThreadPointQueryAndRestoreMessagesWithGroupJID",["LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return d[0]=new c.Map(),d[0].set("wa_jid",a[0]),d[0].set("tam_thread_subtype",c.i64.cast([0,0])),d[1]=d[0].get("wa_jid"),d[2]=c.toJSON(d[0]),c.storedProcedure(b("LSIssueNewTask"),c.i64.to_string(d[1]),c.i64.cast([0,1021]),d[2],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))},function(a){return c.resolve(e)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxThreadPointQueryAndRestoreMessagesWithGroupJIDStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSThreadPointQueryAndRestoreMessagesWithGroupJIDStoredProcedure",["LSSynchronousPromise","LSThreadPointQueryAndRestoreMessagesWithGroupJID","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSThreadPointQueryAndRestoreMessagesWithGroupJID"),e.waJid);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSUpdateBackupsTableStoredProcedure",["LSSynchronousPromise","LSUpdateBackupsTable","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSUpdateBackupsTable"),e.isSuccess,e.backupIds,e.virtualDevices,e.deviceIds,e.backupMetadata,e.traceId,e.isUserOptedOut,e.hasOtcEligibleDevices,e.encryptionManagementDelegatorId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSUpdateE2EEMetadataParticipants",["LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return d[0]=new c.Map(),d[0].set("thread_key",a[0]),d[0].set("user_self_remove",!1),d[1]=d[0].get("thread_key"),d[2]=c.toJSON(d[0]),c.storedProcedure(b("LSIssueNewTask"),c.i64.to_string(d[1]),c.i64.cast([0,394]),d[2],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))},function(a){return c.resolve(e)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxUpdateE2EEMetadataParticipantsStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSUpsertAttachmentRange",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.sequence([function(c){return b.forEach(b.db.table(17).fetch([[[a[0],a[1]]]]),function(a){return a["delete"]()})},function(c){return b.db.table(17).add({threadKey:a[0],mediaGroup:a[1],minTimestampMs:a[2],maxTimestampMs:b.i64.cast([2328,1316134911]),hasMoreBefore:a[3],hasMoreAfter:!1,isLoadingBefore:!1,isLoadingAfter:!1,lastLoadedMessageId:a[4]})}])},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxUpsertAttachmentRangeStoredProcedure";a.__tables__=["attachments_ranges_v2__generated"];e.exports=a}),null);
__d("MAWBridgeGQLUploadUtils",["JSResourceForInteraction"],(function(a,b,c,d,e,f,g){"use strict";async function a(b,d){var a=await c("JSResourceForInteraction")("MAWEncryptedBackupsMessageUploadMutation").__setRef("MAWBridgeGQLUploadUtils").load();return a.uploadMessageOverGQL(b,d)}g.uploadMessageOverGQL=a}),98);
__d("MAWBridgeUpdateDYIStatusV2",["EncryptedBackupdDYIFileSaver","EncryptedBackupsDYIFileUtils","EncryptedBackupsDYITypes","FBLogger","QPLUserFlow","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";async function h(a,b,e){d("EncryptedBackupdDYIFileSaver").saveFile(a,b),window.setTimeout(function(){c("promiseDone")(e())},1e3)}async function a(a){var b=a.qplEvent,e=a.qplInstanceKeyE2E;a=a.status;var f=c("FBLogger")("[labyrinth_web][dyi]");if(a===d("EncryptedBackupsDYITypes").EncryptedBackupsDYIState.Completed)try{if(navigator.storage==null)throw f.mustfixThrow("Storage management API is not supported. Please try one of the supported browsers.");var g=d("EncryptedBackupsDYIFileUtils").DyiArchiveFilename,i=await d("EncryptedBackupsDYIFileUtils").getRootFolderHandle(),j=await d("EncryptedBackupsDYIFileUtils").readFile(i,g);await h(g,j,async function(){await i.removeEntry(g)});f.info("Saving file with filename ",g);b!=null&&e!=null&&c("QPLUserFlow").endSuccess(b,{instanceKey:e});f.info("DYI Complete")}catch(a){f.mustfix("Failed to download the DYI archive: %s",a);b!=null&&e!=null&&c("QPLUserFlow").endFailure(b,a.message,{instanceKey:e});return d("EncryptedBackupsDYITypes").EncryptedBackupsDYIState.Failed}a===d("EncryptedBackupsDYITypes").EncryptedBackupsDYIState.Failed&&(b!=null&&e!=null&&c("QPLUserFlow").endFailure(b,"Unknown error",{instanceKey:e}));return a}g.call=a}),98);
__d("MAWBridgeUploadMessageGQLHandlerSingleTxn",["EBBucketUtils","EBIsEbEnabled","EncryptedBackupsWriteToMPSTables","MAWBridgeGQLUploadUtils","MAWEBFalcoLoggerUtils","MAWEBFrontendQPLLogger","MWEBODSCategory","MWEBODSEntityName.enum","MWEBUseLocalStorage","MWEncryptedBackupsLocalStorageEntryEnum","ODS","WAErrorMessage","WAResultOrError","isInstamadilloEB"],(function(a,b,c,d,e,f,g){"use strict";var h;async function a(a,b){try{if(c("isInstamadilloEB")()){d("MAWEBFrontendQPLLogger").addPointForUploadMessageArray(b,"upload_tracking_gql_cancelled_instamadillo");b.forEach(function(a){var b=a.echoDocument!=null?"dual_upload":"protobuf_only";d("MAWEBFalcoLoggerUtils").logEBFalcoTaskFailure(a,b,"gql_cancelled_instamadillo")});return d("WAResultOrError").makeError("gql_cancelled_instamadillo")}d("MAWEBFrontendQPLLogger").addPointForUploadMessageArray(b,"upload_tracking_gql_handler_single_txn_start");var e="mps_write_failure",g=await a.runInTransaction(async function(f){if(!await d("EBIsEbEnabled").isEbEnabledLS(a.tables)){b.forEach(function(a){if(a.uploadTrackingInstanceKey!=null){var b,e=a.uploadTrackingInstanceKey;d("MAWEBFrontendQPLLogger").addPointEBUploadTracking(e,"user_device_not_enrolled_invalid_gql_request");var f=d("MWEBUseLocalStorage").mwEBGetIsLocalStorageEntryValuePresent(c("MWEncryptedBackupsLocalStorageEntryEnum").MW_EB_HAS_RESTORED_IN_CURRENT_SESSION);b=(b=d("MWEBUseLocalStorage").mwEBGetLocalStorageEntryValue(c("MWEncryptedBackupsLocalStorageEntryEnum").EBSM_CORRUPTION_WIPE))!=null?b:"no";f={bool:{wasEBEnabledPreviously:f},string:{wasEBSMWiped:b}};b=a.echoDocument!=null?"dual_upload":"protobuf_only";d("MAWEBFalcoLoggerUtils").logEBFalcoTaskSkipped(a,b,"user_device_not_enrolled");d("MAWEBFrontendQPLLogger").endEBUploadTracking(e,f)}});var g=[];e="user_device_not_enrolled";return g}else{d("MAWEBFrontendQPLLogger").addPointForUploadMessageArray(b,"upload_tracking_gql_handler_mps_write_start");g=await i(f,b);d("MAWEBFrontendQPLLogger").addPointForUploadMessageArray(b,"upload_tracking_gql_handler_mps_write_end");return g}},"readwrite",void 0,void 0,f.id+":87");g=g.filter(Boolean);if(g.length===0)return d("WAResultOrError").makeError(e);(h||(h=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_TRACKING,"graphql.batch.size."+g.length);h.bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_TRACKING,"graphql.batch.bucket"+d("EBBucketUtils").getBucketName(g.length));d("MAWEBFrontendQPLLogger").addPointForUploadMessageArray(b,"upload_tracking_gql_handler_upload_start");g.forEach(function(a){var b=a.echoDocument!=null?"dual_upload":"protobuf_only";d("MAWEBFalcoLoggerUtils").logEBFalcoTaskIssued(a,b)});var j=await d("MAWBridgeGQLUploadUtils").uploadMessageOverGQL(a,g);d("MAWEBFrontendQPLLogger").addPointForUploadMessageArray(b,"upload_tracking_gql_handler_single_txn_end");!j.success?g.forEach(function(a){var b=a.echoDocument!=null?"dual_upload":"protobuf_only";d("MAWEBFalcoLoggerUtils").logEBFalcoTaskFailure(a,b,j.error)}):g.forEach(function(a){d("MAWEBFalcoLoggerUtils").logEBFalcoEncryptedBackupUploadSuccess(a)});return j}catch(a){b.forEach(function(b){var c=b.echoDocument!=null?"dual_upload":"protobuf_only";d("MAWEBFalcoLoggerUtils").logEBFalcoTaskFailure(b,c,d("WAErrorMessage").maybeGetMessageFromError(a));b.uploadTrackingInstanceKey!=null&&d("MAWEBFrontendQPLLogger").failEBUploadTracking(b.uploadTrackingInstanceKey,"gql_upload_runtime_error",a instanceof Error?{string:{runtime_error:a.message}}:void 0)});return d("WAResultOrError").makeError("gql_upload_runtime_error")}}async function i(a,b){b=b.map(async function(b){var c=b.protoMsg,e=b.uploadTrackingInstanceKey!=null?d("MAWEBFrontendQPLLogger").makeEBFrontendQplFlowFromInstanceKey(b.uploadTrackingInstanceKey):null;if(c!=null){c=c.backupActionType===1?Promise.all([d("EncryptedBackupsWriteToMPSTables").writeToMPSTables(a,c,b.threadId,!1,e),d("EncryptedBackupsWriteToMPSTables").writeTagsToMPSTables(a,c,b.threadId)]).then(function(a){var b=a[0];a[1];return b}):d("EncryptedBackupsWriteToMPSTables").writeToMPSTables(a,c,b.threadId,!1,e);e=await c.then(function(a){if(!a.success&&b.uploadTrackingInstanceKey!=null){d("MAWEBFrontendQPLLogger").failEBUploadTracking(b.uploadTrackingInstanceKey,"mps_write_failed",{string:{error:a.error.errorMsg,errorMsgType:b.messageType}});return null}return b},function(a){b.uploadTrackingInstanceKey!=null&&d("MAWEBFrontendQPLLogger").failEBUploadTracking(b.uploadTrackingInstanceKey,"upload_tracking_gql_handler_failed_mps_write",{string:{error:d("WAErrorMessage").maybeGetMessageFromError(a),errorMsgType:b.messageType}});return null});return e}return b});b=await Promise.all(b);return b.filter(Boolean)}g.call=a}),98);
__d("MAWBridgeUploadMessageByBatchGQLHandler",["FBLogger","MAWBridgeSafeActionsWorkerAndUI","MAWBridgeUploadMessageGQLHandlerSingleTxn","MAWEBFrontendQPLLogger","MWEBODSEntityName.enum","ODS","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";var h;async function a(a,b){(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_COUNTER,"main_thread");d("MAWEBFrontendQPLLogger").addPointForUploadMessageArray(b.messages,"upload_tracking_bridge_batch_handler_gql");var e=await d("MAWBridgeUploadMessageGQLHandlerSingleTxn").call(a,b.messages);if(e.success){a=b.messages.map(function(a){if(a.uploadTrackingInstanceKey!=null)return{instanceKey:a.traceId,success:!0};else return null}).filter(Boolean);d("MAWBridgeSafeActionsWorkerAndUI").fireAndForgetBackendWorkerAndUIShared("ackWithInstanceKeyBatched",{instancesWithOutcomes:a});c("FBLogger")("labyrinth_web").info("Successfully completed GQL upload batch of size %s",b.messages.length);return d("WAResultOrError").makeResult()}b.messages.forEach(function(a){a.uploadTrackingInstanceKey!=null&&d("MAWEBFrontendQPLLogger").failEBUploadTracking(a.uploadTrackingInstanceKey,"gql_upload_failed",{string:{error:e.error}})});return d("WAResultOrError").makeError(e.error)}g.call=a}),98);
__d("MAWFTSMergeCutoverSearchResults",["fbt","I64"],(function(a,b,c,d,e,f,g,h){"use strict";var i;function a(a,b){var c,e;c=(i||(i=d("I64"))).add((c=a.matchCount)!=null?c:(i||(i=d("I64"))).of_string("1"),(c=b.matchCount)!=null?c:(i||(i=d("I64"))).of_string("1"));b=i.max((e=a.messageTimestampMs)!=null?e:(i||(i=d("I64"))).minus_one,(e=b.messageTimestampMs)!=null?e:(i||(i=d("I64"))).minus_one);return babelHelpers["extends"]({},a,{contextLine:h._(/*BTDS*/"_j{\"*\":\"\\u0421\\u043e\\u043e\\u0431\\u0449\\u0435\\u043d\\u0438\\u0439 \\u0441 \\u0441\\u043e\\u0432\\u043f\\u0430\\u0434\\u0435\\u043d\\u0438\\u044f\\u043c\\u0438: {number}\",\"_1\":\"\\u0421\\u043e\\u043e\\u0431\\u0449\\u0435\\u043d\\u0438\\u0439 \\u0441 \\u0441\\u043e\\u0432\\u043f\\u0430\\u0434\\u0435\\u043d\\u0438\\u044f\\u043c\\u0438: 1\"}",[h._plural(i.to_int32(c),"number")]).toString(),matchCount:c,matchLengths:void 0,matchOffsets:void 0,messageId:void 0,messageTimestampMs:(i||(i=d("I64"))).equal(b,(i||(i=d("I64"))).minus_one)?void 0:b})}g.mergeCutoverSearchResults=a}),226);
__d("MAWFTSRawStringMatcher",["JSResourceForInteraction","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h=c("JSResourceForInteraction")("WAFtsMultiLangTokenizer").__setRef("MAWFTSRawStringMatcher"),i=null;async function a(){i=await h.load();return k}function j(a){return new(c("nullthrows")(i))().tokenize(a)}function k(a,b){a=Array.from(j(a)).filter(function(a){return a.length>1});if(a.length===0)return!1;var c=Array.from(j(b));return a.every(function(a){return c.some(function(b){return b.startsWith(a)})})}g.load=a}),98);
__d("MAWFTSUniversalSearchQPLLogger",["QPLUserFlow","emptyFunction","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h={hasStarted:!1,instanceKey:5e3},i=c("qpl")._(25301522,"2409");function a(){h.hasStarted&&j();h.instanceKey++;h.hasStarted=!0;c("QPLUserFlow").start(i,{annotations:{bool:{isInThread:!1}},instanceKey:h.instanceKey});return h.instanceKey}function j(a){if(!h.hasStarted||a!=null&&h.instanceKey!==a)return;h.hasStarted=!1;c("QPLUserFlow").endCancel(i,{instanceKey:h.instanceKey})}function b(a){var b=a.annotations,d=a.instanceKey;a=a.point;if(!h.hasStarted||d!=null&&h.instanceKey!==d)return;c("QPLUserFlow").addPoint(i,a,{instanceKey:h.instanceKey});b!=null&&k({annotations:b,instanceKey:h.instanceKey})}function k(a){var b=a.annotations;a=a.instanceKey;if(!h.hasStarted||a!=null&&h.instanceKey!==a)return;c("QPLUserFlow").addAnnotations(i,b,{instanceKey:h.instanceKey})}function d(a){if(!h.hasStarted||a!=null&&h.instanceKey!==a)return;h.hasStarted=!1;c("QPLUserFlow").endSuccess(i,{annotations:{"int":{result_count:h.currentResultCount}},instanceKey:h.instanceKey})}e={getCurrentInstanceKey:function(){return h.instanceKey},qplAddAnnotations:k,qplAddPoint:b,qplCancel:j,qplMarkFirstResultShowUp:c("emptyFunction"),qplStart:a,qplSuccess:d,updateCurrentResultCount:c("emptyFunction")};f=e;g["default"]=f}),98);
__d("escapeRegExp",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}f["default"]=a}),66);
__d("MWContentSearchUtils",["fbt","I64","LSIntEnum","LSMessageSearchType","MAWVault","escapeRegExp","gkx"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=c("gkx")("1798");function l(a){return a.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}function m(a,b){a=l(a).split(" ");var d=l(b),e=[],f=[];a.forEach(function(a){var b=new RegExp(c("escapeRegExp")(a),"gi");b=d.matchAll(b);b=Array.from(b);b=b.map(function(a){return a.index});var g=b.map(function(b){return a.length});f.push.apply(f,b);e.push.apply(e,g)});return{matchLengths:e.join(","),matchOffsets:f.join(",")}}function a(a,b,e,f){if(e!=null&&(b===1||(i||(i=d("I64"))).equal(f,(j||(j=d("LSIntEnum"))).ofNumber(c("LSMessageSearchType").MESSAGE)))){f=d("MAWVault").isVaulted(e)?d("MAWVault").unvault(e):e;e=m(a,f);return babelHelpers["extends"]({contextLine:f},e)}else return{contextLine:h._(/*BTDS*/"_j{\"*\":\"\\u0421\\u043e\\u043e\\u0431\\u0449\\u0435\\u043d\\u0438\\u0439 \\u0441 \\u0441\\u043e\\u0432\\u043f\\u0430\\u0434\\u0435\\u043d\\u0438\\u044f\\u043c\\u0438: {number}\",\"_1\":\"\\u0421\\u043e\\u043e\\u0431\\u0449\\u0435\\u043d\\u0438\\u0439 \\u0441 \\u0441\\u043e\\u0432\\u043f\\u0430\\u0434\\u0435\\u043d\\u0438\\u044f\\u043c\\u0438: 1\"}",[h._plural(b,"number")]).toString(),matchLengths:void 0,matchOffsets:void 0}}function b(a,b){return a===1&&b!=null?b:void 0}function e(a,b){return a===1&&b!=null?b:void 0}function f(a){return a!=null?(i||(i=d("I64"))).of_float(a):void 0}function n(a,b){a=(i||(i=d("I64"))).of_float(-a);return b==null?a:i.min(a,b)}function o(a,b){if(!k||a.messageTimestampMs==null||b.messageTimestampMs==null)if((i||(i=d("I64"))).gt(a.globalIndex,b.globalIndex))return 1;else if((i||(i=d("I64"))).lt(a.globalIndex,b.globalIndex))return-1;else return 0;else if((i||(i=d("I64"))).lt(a.messageTimestampMs,b.messageTimestampMs))return 1;else if((i||(i=d("I64"))).gt(a.messageTimestampMs,b.messageTimestampMs))return-1;else return 0}g.getContextLineAndMatches=a;g.getMessageOtid=b;g.getMessageId=e;g.getMessageTimestamp=f;g.getGlobalIndex=n;g.searchResultsCompareFn=o}),226);
__d("groupBy",[],(function(a,b,c,d,e,f){function a(a,b){return a.reduce(function(a,c){(a[b(c)]=a[b(c)]||[]).push(c);return a},{})}f["default"]=a}),66);
__d("waitForMiActMappingForUniversalSearch",["FBLogger","I64","LSAuthorityLevel","LSFactory","LSThreadPointQueryAndRestoreMessagesWithGroupJIDStoredProcedure","LSThreadPointQueryAndRestoreMessagesWithJIDStoredProcedure","MAWCurrentUser","MAWJids","ReQL","WAJids","emptyFunction","err","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i=3e4,j=3e4;async function k(a){a=await d("ReQL").toArrayAsync(a);return a.some(function(a){return a==null||(h||(h=d("I64"))).lt(a.authorityLevel,(h||(h=d("I64"))).of_int32(c("LSAuthorityLevel").AUTHORITATIVE))})===!1}async function l(a,b,e,f){e===void 0&&(e=c("emptyFunction"));f===void 0&&(f=c("emptyFunction"));var g=(h||(h=d("I64"))).of_string(d("MAWCurrentUser").getID()),i=d("ReQL").leftJoin(d("ReQL").fromTableAscending(a.tables.participants,["contactId"]).getKeyRange(b.serverThreadKey).filter(function(a){return!(h||(h=d("I64"))).equal(a.contactId,g)}),d("ReQL").fromTableAscending(a.tables.contacts)).map(function(a){a[0];a=a[1];return a}),l=null,m={contents:function(){}};function n(){e(b),m.contents()}if(await k(i))return n();m.contents=i.subscribe(async function(a,b){if(b.operation==="delete")return;l!=null&&window.clearTimeout(l);if(await k(i))return n()});l=window.setTimeout(function(){m.contents(),f(c("err")("Contacts timed out"))},j)}async function a(a,b){var e=d("MAWJids").convertChatJidToIntJid(b),g=d("WAJids").interpretAsGroupJid(b)!=null,h=d("ReQL").fromTableAscending(a.tables.mi_act_mapping_table.index("jid")).getKeyRange(e);b=await d("ReQL").firstAsync(h);if(b!=null){await l(a,b);return Promise.resolve(b)}var j=null,k=new Promise(function(b,d){var e={contents:function(){}};function f(a){e.contents(),b(a)}function g(a){e.contents(),d(a)}e.contents=h.subscribe(async function(b,c){if(c.operation==="delete")return;j!=null&&window.clearTimeout(j);await l(a,c.value,f,g)});j=window.setTimeout(function(){g(c("err")("MiActMapping timed out"))},i)});c("promiseDone")(a.runInTransaction(function(a){return g?c("LSThreadPointQueryAndRestoreMessagesWithGroupJIDStoredProcedure")(c("LSFactory")(a),{waJid:e}):c("LSThreadPointQueryAndRestoreMessagesWithJIDStoredProcedure")(c("LSFactory")(a),{waJid:e})},"readwrite",void 0,void 0,f.id+":149"));try{b=await k}catch(a){c("FBLogger")("messenger_web").warn("[FTS] Issue waiting for mi_act_mapping to be ready",a)}return b}g.default=a}),98);
__d("MAWUniversalMessageSearch",["FBLogger","I64","JSResourceForInteraction","LSIntEnum","LSMessageSearchType","LSMessagingThreadTypeUtil","LSSearchRequestStatusType","MAWBridgeSearchMsg","MAWBridgeSendAndReceive","MAWFTSMergeCutoverSearchResults","MAWFTSUniversalSearchQPLLogger","MWContentSearchUtils","MWSearchThreadUtils","ReQL","groupBy","promiseDone","waitForMiActMappingForUniversalSearch"],(function(a,b,c,d,e,f,g){"use strict";var h=["matchedTerms","recordType"],i,j,k=(i||(i=d("LSIntEnum"))).ofNumber(c("LSMessageSearchType").THREAD),l=new Map(),m=c("JSResourceForInteraction")("MAWAsyncEBIssueBulkMessagesPointQuery").__setRef("MAWUniversalMessageSearch");async function n(a,b,c){await a.message_search_queries.put(babelHelpers.extends({hasNextPage:!1,query:b,threadKeyV2:(j||(j=d("I64"))).one,type_:k},c))}async function o(a,b){var c=(j||(j=d("I64"))).to_string(b.threadKey);b.matchCount!=null&&l.set(c,(j||(j=d("I64"))).to_float(b.matchCount));c=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.message_search_results).getKeyRange(k,b.query,b.threadKey));if(c==null)await a.message_search_results.put(babelHelpers.extends({},b));else{var e=d("MAWFTSMergeCutoverSearchResults").mergeCutoverSearchResults(c,b);await a.message_search_results.upsert([k,c.query,c.threadKey,c.globalIndex],babelHelpers.extends({},e,{globalIndex:b.globalIndex}))}}function a(a,b){var c;c=(c=l.get((j||(j=d("I64"))).to_string(a)))!=null?c:0;c+=b;l.set((j||(j=d("I64"))).to_string(a),c)}function b(){l.clear()}function e(a,b){return!d("LSMessagingThreadTypeUtil").isArmadilloSecure(b)?null:(b=l.get((j||(j=d("I64"))).to_string(a)))!=null?b:null}async function p(a,b,e){l.clear();await a.runInTransaction(async function(a){await n(a,e,{resultCount:(j||(j=d("I64"))).zero,status:(i||(i=d("LSIntEnum"))).ofNumber(c("LSSearchRequestStatusType").PENDING)})},"readwrite",void 0,void 0,f.id+":142");c("MAWFTSUniversalSearchQPLLogger").qplAddPoint({point:"search_local_result_start"});var g=await d("MAWBridgeSendAndReceive").sendAndReceive("backend","search",{query:e,searchMode:d("MAWBridgeSearchMsg").MESSAGE_CONTENT_SEARCH});g=g.map(function(a){if(a.recordType==="msg"){a.matchedTerms;a.recordType;a=babelHelpers.objectWithoutPropertiesLoose(a,h);return babelHelpers.extends({},a)}}).filter(Boolean);g=c("groupBy")(g,function(a){return a.chatJid});var p=Object.values(g);c("MAWFTSUniversalSearchQPLLogger").qplAddPoint({annotations:{int:{numResult:p.length}},point:"search_local_result_end"});c("promiseDone")(Promise.all(p.map(async function(g,h){var i=g[0].chatJid;await c("waitForMiActMappingForUniversalSearch")(a,i);var l=await d("MWSearchThreadUtils").getThreadDataForSearchResult(a,i,b,k);if(l==null)return;var n=l.profilePicUrl,p=l.secondaryProfilePicUrl,q=l.threadDisplayName,r=l.threadKey;l=l.threadType;var s=g.sort(function(a,b){return b.sortOrderMs-a.sortOrderMs})[0],t=g.length===1&&s.msg==null?{id:s.externalId,sortOrderMs:s.sortOrderMs}:null,u={displayName:q,globalIndex:d("MWContentSearchUtils").getGlobalIndex(s.sortOrderMs),matchCount:(j||(j=d("I64"))).of_int32(g.length),profilePicUrl:n,query:e,secondaryProfilePicUrl:p,threadKey:r,threadType:l,type_:k};if(t==null)await a.runInTransaction(async function(a){var b,c;await o(a,babelHelpers.extends({},u,d("MWContentSearchUtils").getContextLineAndMatches(e,g.length,s==null||(b=s.msg)==null?void 0:b.content,k),{messageId:d("MWContentSearchUtils").getMessageId(g.length,s==null||(c=s.msg)==null?void 0:c.msgId),messageOtid:d("MWContentSearchUtils").getMessageOtid(g.length,s==null?void 0:s.externalId),messageTimestampMs:d("MWContentSearchUtils").getMessageTimestamp(s==null?void 0:s.sortOrderMs)}))},"readwrite",void 0,void 0,f.id+":243");else{c("MAWFTSUniversalSearchQPLLogger").qplAddPoint({point:"fetch_missing_message_"+h+"_start"});q=await m.load().then(function(b){b=b.issueQueryAsPromiseForSearchResult;return b(a,i,[t],"viewerId")});if(q!=null&&q.length!==0){var v=q[0];c("MAWFTSUniversalSearchQPLLogger").qplAddPoint({point:"fetch_missing_message_"+h+"_end"});await a.runInTransaction(async function(a){var b;await o(a,babelHelpers.extends({},u,d("MWContentSearchUtils").getContextLineAndMatches(e,g.length,s==null||(b=s.msg)==null?void 0:b.content,k),{messageOtid:v.externalId,messageTimestampMs:v.sortOrderMs!=null?(j||(j=d("I64"))).of_float(v.sortOrderMs):void 0}))},"readwrite",void 0,void 0,f.id+":285")}else c("MAWFTSUniversalSearchQPLLogger").qplAddPoint({annotations:{bool:{failedFetchingMissingMessage:!0}},point:"fetch_missing_message_"+h+"_end"})}})),function(){c("MAWFTSUniversalSearchQPLLogger").qplAddPoint({annotations:{int:{numResult:p.length}},point:"issue_secure_search_query_end"}),c("promiseDone")(a.runInTransaction(async function(a){await n(a,e,{hasNextPage:!1,resultCount:(j||(j=d("I64"))).of_int32(p.length),status:(i||(i=d("LSIntEnum"))).ofNumber(c("LSSearchRequestStatusType").COMPLETE)})},"readwrite",void 0,void 0,f.id+":325"))},function(a){c("FBLogger")("maw_fts_search").mustfix("Error while searching in secure threads. Err: %s",a==null?void 0:a.message)})}g.updateSecureMsgMatchCountForThread=a;g.clearSecureMsgMatchCountForThread=b;g.getSecureMsgsMatchCountForThread=e;g.search=p}),98);
__d("MWChatEncryptedBackupsAddDeviceWithEBKeys",["EBMainThreadEBDBApiDeferred","EBSMAPI","EBWorkerODSEntityName.enum","cr:21222"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var e=a.backupId,f=a.db,g=a.newDeviceRegistrationId,h=a.previousDeviceId;return c("EBSMAPI").addDeviceWithEBKeys({backupId:e,db:f,isInWorker:!1,newDeviceRegistrationId:g,previousDeviceId:h,source:c("EBWorkerODSEntityName.enum").MW_EB_AUTO_RESTORE_MAIN_THREAD,trackAddingDevice:function(a){void d("EBMainThreadEBDBApiDeferred").addNewDevice(a)}}).then(function(){return b("cr:21222")==null?void 0:b("cr:21222").fireAndForget("backend","addDeviceWithKeysInWorker",{backupId:e,deviceRegistrationId:g,isAutoRestore:!0,previousDeviceId:h,source:c("EBWorkerODSEntityName.enum").MW_EB_AUTO_RESTORE_WORKER})})}g.addDeviceWithEBKeys=a}),98);
__d("MWChatEncryptedBackupsHandleRestoreWrapper.react",["cr:6736","cr:8598","cr:8599","cr:8601"],(function(a,b,c,d,e,f,g){"use strict";function a(){b("cr:8598")==null||b("cr:8598")();b("cr:8599")==null||b("cr:8599")();b("cr:8601")==null||b("cr:8601")();b("cr:6736")==null||b("cr:6736")();return null}g["default"]=a}),98);
__d("isEBSearchEnabled",["gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("gkx")("4741")}g["default"]=a}),98);
__d("MWInboxSecureContentSearch",["I64","JSResourceForInteraction","LSIntEnum","LSMessageSearchType","LSSearchRequestStatusType","MAWBridgeSearchMsg","MAWBridgeSendAndReceive","MAWChatJid","MAWFTSMergeCutoverSearchResults","MAWMiActOnActThreadReadyDeferred","MAWUniversalMessageSearch","MWContentSearchUtils","MWSearchThreadUtils","ReQL","emptyFunction","groupBy","isEBSearchEnabled","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h=["matchedTerms","recordType"],i,j,k=c("JSResourceForInteraction")("MAWAsyncEBIssueBulkMessagesPointQuery").__setRef("MWInboxSecureContentSearch"),l=c("justknobx")._("2605");function a(a,b,c){var e;return Promise.all([(e=d("ReQL")).mergeJoin(e.fromTableAscending(c.tables.participants,[]).getKeyRange(a),e.fromTableAscending(c.tables.contacts)),e.firstAsync(e.fromTableAscending(c.tables.threads).getKeyRange(a))]).then(function(a){var c=a[0];a[1];a=c.filter(function(a){a[0];a=a[1];a=(i||(i=d("I64"))).equal(a.id,b);return!a}).map(function(a){a[0];a=a[1];return a});return d("ReQL").firstAsync(a)})}function m(a,b){return d("MAWChatJid").toThreadKeyMaybe(b,a.chatJid).then(function(c){return c==null?Promise.resolve([null,a]):Promise.all([d("ReQL").firstAsync(d("ReQL").fromTableAscending(b.threads).getKeyRange(c)),Promise.resolve(a)])})}async function n(a,b){a=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.contacts).getKeyRange((i||(i=d("I64"))).of_string(b)));return a}function o(a,b){var e=b.query;b=b.threadKey;return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.message_search_results).getKeyRange((j||(j=d("LSIntEnum"))).ofNumber(c("LSMessageSearchType").THREAD),e,b))}function p(a,b,e,g,h,k,l,p){p===void 0&&(p=c("LSSearchRequestStatusType").COMPLETE);var q=function(f){return m(a,f).then(function(a){var l=a[0];if(l==null)return;var m=a[1],q=m.msg;if(q==null)return;if(m!=null)return Promise.all([d("MWSearchThreadUtils").getThreadPics(l,h,k),d("MWSearchThreadUtils").getThreadParticipants(l,k),(i||(i=d("I64"))).equal(g,(j||(j=d("LSIntEnum"))).ofNumber(c("LSMessageSearchType").MESSAGE))?n(k,q.sender):Promise.resolve(null),(i||(i=d("I64"))).equal(g,(j||(j=d("LSIntEnum"))).ofNumber(c("LSMessageSearchType").THREAD))?o(f,{query:e,threadKey:l.threadKey}):Promise.resolve(null)]).then(function(a){var k=a[0],n=k[0];k=k[1];var o=a[1],r=a[2];a=a[3];(i||(i=d("I64"))).equal(g,(j||(j=d("LSIntEnum"))).ofNumber(c("LSMessageSearchType").THREAD))&&d("MAWUniversalMessageSearch").updateSecureMsgMatchCountForThread(l.threadKey,b);o=babelHelpers.extends({},d("MWContentSearchUtils").getContextLineAndMatches(e,b,q.content,g),{displayName:d("MWSearchThreadUtils").getThreadDisplayName(h,l,o,r,g),globalIndex:(i||(i=d("I64"))).of_float(-m.sortOrderMs),matchCount:i.of_int32(b),messageId:q.msgId,messageOtid:m.externalId,messageTimestampMs:(i||(i=d("I64"))).equal(g,(j||(j=d("LSIntEnum"))).ofNumber(c("LSMessageSearchType").THREAD))&&b>1?void 0:(i||(i=d("I64"))).of_string(""+m.sortOrderMs),profilePicUrl:(i||(i=d("I64"))).equal(g,(j||(j=d("LSIntEnum"))).ofNumber(c("LSMessageSearchType").MESSAGE))&&r!=null?r.profilePictureUrl:n,query:e,secondaryProfilePicUrl:(i||(i=d("I64"))).equal(g,(j||(j=d("LSIntEnum"))).ofNumber(c("LSMessageSearchType").MESSAGE))&&r!=null?r.profilePictureFallbackUrl:k,threadKey:l.threadKey,threadType:l.threadType,type_:g});if((i||(i=d("I64"))).equal(g,(j||(j=d("LSIntEnum"))).ofNumber(c("LSMessageSearchType").THREAD))||a==null)n=f.message_search_results.put(o);else{r=d("MAWFTSMergeCutoverSearchResults").mergeCutoverSearchResults(a,o);n=f.message_search_results.upsert([g,a.query,a.threadKey,a.globalIndex],babelHelpers.extends({},r,{globalIndex:o.globalIndex}))}return Promise.all([f.message_search_queries.put({hasNextPage:void 0,nextPageCursor:void 0,query:e,resultCount:i.of_int32(b),status:(j||(j=d("LSIntEnum"))).ofNumber(p),threadKeyV2:l.threadKey,type_:g}),n]).then(c("emptyFunction"))})})};return l!=null?q(l):k.runInTransaction(function(a){return q(a)},"readwrite",void 0,void 0,f.id+":284")}async function q(a,b,c,e){e!=null&&e.flow.qplAddPoint({instanceKey:e.instanceKey,point:"search_local_result_start"});b=await d("MAWBridgeSendAndReceive").sendAndReceive("backend","search",{query:b,searchMode:d("MAWBridgeSearchMsg").MESSAGE_CONTENT_SEARCH});return Promise.all(b.map(function(b){if(b.recordType==="msg"){b.matchedTerms;b.recordType;var c=babelHelpers.objectWithoutPropertiesLoose(b,h);return d("MAWChatJid").toThreadKeyMaybe(a.tables,c.chatJid).then(function(a){return[c,a]})}}).filter(Boolean)).then(function(a){a=c!=null?a.filter(function(a){a[0];a=a[1];return a!=null&&(i||(i=d("I64"))).equal(a,c)}):a.filter(function(a){a[0];a=a[1];return a!=null});var b=null;c!=null&&(b={int:{numResult:a.length}});e!=null&&e.flow.qplAddPoint({annotations:babelHelpers.extends({},b),instanceKey:e.instanceKey,point:"search_local_result_end"});return a})}function b(a,b,e,f){d("MAWUniversalMessageSearch").clearSecureMsgMatchCountForThread();return q(e,a,void 0,f).then(function(g){g=Object.values(c("groupBy")(g,function(a){a[0];a=a[1];return a==null?"":(i||(i=d("I64"))).to_string(a)}));f!=null&&f.flow.qplAddAnnotations({annotations:{int:{numResult:g.length}}});return g.map(function(f){var g=f[0];if(g!==null){g=g[0];return p(g,f.length,a,(j||(j=d("LSIntEnum"))).ofNumber(c("LSMessageSearchType").THREAD),b,e)}}).reduce(function(a,b){return Promise.all([a,b]).then(c("emptyFunction"))},Promise.resolve())})}function e(a,b,e,f,g,h){return Promise.all(f.map(function(f){return p(f,g,e,(j||(j=d("LSIntEnum"))).ofNumber(c("LSMessageSearchType").MESSAGE),h,a,b)})).then(c("emptyFunction"))}function r(a,b,e,f,g){return Promise.all(e.map(function(e){return p(e,f,b,(j||(j=d("LSIntEnum"))).ofNumber(c("LSMessageSearchType").MESSAGE),g,a)})).then(c("emptyFunction"))}function s(a,b,e,g,h){return g.runInTransaction(function(e){return e.message_search_queries.put({hasNextPage:void 0,nextPageCursor:void 0,query:a,resultCount:(i||(i=d("I64"))).of_int32(0),status:(j||(j=d("LSIntEnum"))).ofNumber(c("LSSearchRequestStatusType").PENDING),threadKeyV2:b,type_:j.ofNumber(c("LSMessageSearchType").MESSAGE)})},"readwrite",void 0,void 0,f.id+":465").then(function(c){return q(g,a,b,h)}).then(function(m){var n=m.length,o=m.filter(function(a){var b=a[0];a[1];return b.msg!=null}).length,q=o,s=function(){var f=m.map(function(a){a=a[0];return a}).filter(function(a){return a.msg==null});if(f.length===0)return Promise.resolve();f=f.slice(0,l);h.flow.qplAddPoint({annotations:{int:{numRequestedMessages:f.length}},instanceKey:h.instanceKey,point:"fetch_missing_messages_start"});return c("MAWMiActOnActThreadReadyDeferred")(g,b,"MWMessageSearchInput.react",function(b,c){var j=f.map(function(a){return{id:a.externalId,sortOrderMs:a.sortOrderMs}});return k.load().then(function(b){var f=b.issueQueryAsPromiseForSearchResult,k=(i||(i=d("I64"))).to_string(e);b=f(g,c,j,k);return b==null?Promise.resolve():b.then(async function(b){var d=b;if(b.length!==j.length){h.flow.qplAddPoint({annotations:{int:{numRemainingMessages:j.length-b.length}},instanceKey:h.instanceKey,point:"fetch_missing_messages_partial"});var i=j.filter(function(a){return!d.some(function(b){return b.externalId===a.id})});if(i.length>0){i=await f(g,c,i,k);i!=null&&(d=[].concat(b,i))}}q=o+d.length;h.flow.qplAddPoint({annotations:{int:{numRespondedMessages:d.length}},instanceKey:h.instanceKey,point:"fetch_missing_messages_end"});return r(g,a,d,q,e)})})})};return Promise.all([m.map(function(b){b=b[0];return p(b,n,a,(j||(j=d("LSIntEnum"))).ofNumber(c("LSMessageSearchType").MESSAGE),e,g,void 0,c("LSSearchRequestStatusType").PENDING)}).reduce(function(a,b){return Promise.all([a,b]).then(c("emptyFunction"))},Promise.resolve()),c("isEBSearchEnabled")()?s():Promise.resolve()]).then(function(e){return g.runInTransaction(function(e){return e.message_search_queries.put({hasNextPage:void 0,nextPageCursor:void 0,query:a,resultCount:(i||(i=d("I64"))).of_int32(q),status:(j||(j=d("LSIntEnum"))).ofNumber(c("LSSearchRequestStatusType").COMPLETE),threadKeyV2:b,type_:j.ofNumber(c("LSMessageSearchType").MESSAGE)})},"readwrite",void 0,void 0,f.id+":620")}).then(function(a){return Promise.resolve()})})}g.getThreadOtherParticipantContact=a;g.searchSecureDatabaseThreads=b;g.addBridgeSearchMsgsToSearchResult=e;g.addMessagesToSearchResult=r;g.searchSecureDatabaseMessages=s}),98);
__d("useMWV2ChatCloseTabs",["MWChatStateActions","MWChatStateContext","MWChatStateV2.react","MessengerWebEventsFalcoEvent","react","react-compiler-runtime","useCometFeedNoRoutingNavigationEventLogger"],(function(a,b,c,d,e,f,g){"use strict";var h;(h||d("react")).useCallback;function a(){var a=d("react-compiler-runtime").c(4),b=c("useCometFeedNoRoutingNavigationEventLogger")(),e=d("MWChatStateContext").useChatState(j),f=d("MWChatStateV2.react").useDispatch(),g;a[0]!==f||a[1]!==b||a[2]!==e?(g=function(){b(Date.now(),"","messenger");c("MessengerWebEventsFalcoEvent").log(i);var a=Date.now();return f(Array.from(e.values()).flatMap(function(b){return d("MWChatStateActions").closeTab(a,b.tabId)}))},a[0]=f,a[1]=b,a[2]=e,a[3]=g):g=a[3];return g}function i(){return{event_name:"close_all_chat_tabs"}}function j(a){return a.tabs}g["default"]=a}),98);
__d("useMWV2ChatMinimizeTabs",["MWChatStateActions","MWChatStateContext","MWChatStateV2.react","MWChatStateV2IsOpen","MessengerWebEventsFalcoEvent","react","react-compiler-runtime","useCometFeedNoRoutingNavigationEventLogger"],(function(a,b,c,d,e,f,g){"use strict";var h;(h||d("react")).useCallback;function a(){var a=d("react-compiler-runtime").c(4),b=c("useCometFeedNoRoutingNavigationEventLogger")(),e=d("MWChatStateContext").useChatState(k),f=d("MWChatStateV2.react").useDispatch(),g;a[0]!==f||a[1]!==b||a[2]!==e?(g=function(){b(Date.now(),"","messenger");c("MessengerWebEventsFalcoEvent").log(j);var a=Date.now();return f(Array.from(e.values()).filter(i).flatMap(function(b){return d("MWChatStateActions").minimizeTab(a,b.tabId)}))},a[0]=f,a[1]=b,a[2]=e,a[3]=g):g=a[3];return g}function i(a){return d("MWChatStateV2IsOpen").isOpen(void 0,a)}function j(){return{event_name:"minimize_all_chat_tabs"}}function k(a){return a.tabs}g["default"]=a}),98);
__d("MWV2ChatOptionsHeadPopover.react",["fbt","FDSCrossCircleOutline20Icon","FDSMinusCircleOutline20Icon","MWXMenu.react","MWXMenuItem.react","react","react-compiler-runtime","useMWV2ChatCloseTabs","useMWV2ChatMinimizeTabs"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react");function a(a){var b=d("react-compiler-runtime").c(12);a=a.hasOpenTabs;var e=c("useMWV2ChatCloseTabs")(),f=c("useMWV2ChatMinimizeTabs")(),g;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(g=h._(/*BTDS*/"\u041c\u0435\u043d\u044e \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u043e\u0432 \u0447\u0430\u0442\u043e\u0432"),b[0]=g):g=b[0];var i;b[1]!==e?(i=function(a){return e()},b[1]=e,b[2]=i):i=b[2];var k;b[3]===Symbol["for"]("react.memo_cache_sentinel")?(k=h._(/*BTDS*/"\u0417\u0430\u043a\u0440\u044b\u0442\u044c \u0432\u0441\u0435 \u0447\u0430\u0442\u044b"),b[3]=k):k=b[3];b[4]!==i?(k=j.jsx(c("MWXMenuItem.react"),{icon:c("FDSCrossCircleOutline20Icon"),onClick:i,primaryText:k,testid:void 0}),b[4]=i,b[5]=k):k=b[5];b[6]!==a||b[7]!==f?(i=a?j.jsx(c("MWXMenuItem.react"),{icon:c("FDSMinusCircleOutline20Icon"),onClick:function(a){return f()},primaryText:h._(/*BTDS*/"\u0421\u0432\u0435\u0440\u043d\u0443\u0442\u044c \u043e\u0442\u043a\u0440\u044b\u0442\u044b\u0435 \u0447\u0430\u0442\u044b"),testid:void 0}):null,b[6]=a,b[7]=f,b[8]=i):i=b[8];b[9]!==k||b[10]!==i?(a=j.jsxs(c("MWXMenu.react"),{"aria-label":g,withArrow:!0,children:[k,i]}),b[9]=k,b[10]=i,b[11]=a):a=b[11];return a}g["default"]=a}),226);
__d("WebStorageManagerEstimatesFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("2144");b=d("FalcoLoggerInternal").create("web_storage_manager_estimates",a);e=b;g["default"]=e}),98);
__d("checkIsUserOptedOutOfAutoRestore",["I64","LSAuthorityLevel","LSIntEnum","MWEBUseLocalStorage","MWEncryptedBackupsLocalStorageEntryEnum","ReQL","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i;async function a(a){var b=d("MWEBUseLocalStorage").mwEBGetLocalStorageEntryValue(c("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_REMEMBER_BROWSER_CONSENT);if(b!=null)return;b=await a;a=d("ReQL").fromTableAscending(b.tables.secure_encrypted_backups_client_state).filter(function(a){a=a.authorityLevel;return(h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))});var e=await d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(b.tables.auto_restore_opt_out));a=await d("ReQL").firstAsync(a);var g=c("MWEncryptedBackupsLocalStorageEntryEnum").MW_EB_HAS_OPTED_OUT_OF_AUTO_RESTORE,j=d("MWEBUseLocalStorage").mwEBGetIsLocalStorageEntryValuePresent(c("MWEncryptedBackupsLocalStorageEntryEnum").MW_EB_HAS_SET_UP_IN_CURRENT_SESSION);e=e.filter(function(a){return a.optOutKey===g}).length>0;if(!e&&a!=null&&j==null){var k="true";c("promiseDone")(b.runInTransaction(function(a){return a.auto_restore_opt_out.upsert([g],{optOutKey:g,optOutValue:k})},"readwrite","background",void 0,f.id+":73"))}}g.default=a}),98);
__d("mwEBSetBackupState",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b=a.setBackupState;a=a.state;switch(a){case 1:break;case 2:b(2);break;case 3:b(3);break;case 4:b(4);break;case-1:b(-1);break;case 0:break}}f["default"]=a}),66);
__d("mwEBUpdateBackupsTable",["LSFactory","LSUpdateBackupsTableStoredProcedure","LSVec"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.backupIds,d=a.deviceIds,e=a.encryptionManagementDelegatorId,g=a.hasOtcEligibleDevices,h=a.isSuccess,i=a.isUserOptedOut,j=a.storage,k=a.virtualDevices;return j.runInTransaction(function(a){return c("LSUpdateBackupsTableStoredProcedure")(c("LSFactory")(a),{backupIds:b,backupMetadata:c("LSVec").ofArray([]),deviceIds:d,encryptionManagementDelegatorId:e,hasOtcEligibleDevices:g,isSuccess:h,isUserOptedOut:i,virtualDevices:k})},"readwrite",void 0,void 0,f.id+":48")}g["default"]=a}),98);
__d("mwProcessBackupIds",["I64","LSAuthorityLevel","LSIntEnum","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWEncryptedBackupsFirstRestoreUpsellTime","QPLEvent","QPLUserFlow","WebSession"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k="-1";function l(a){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent,"EB_STATE_"+a+"."),d("MWChatEncryptedBackupsLogging").endSuccess({event:d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent})}function m(a){var b=a.clientStateData;a=a.encryptedBackupData;a=a==null?void 0:a.backupId;if(a==null){l("NO_BACKUPS_PRESENT");return 2}if((h||(h=d("I64"))).to_string(a)===k){d("MWChatEncryptedBackupsLogging").endFailure({errorName:"FETCH_ERROR",event:d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent});return-1}if(b==null||!(h||(h=d("I64"))).equal(b.authorityLevel,(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))){l("DEVICE_NOT_ONBOARDED");return 4}if(!(h||(h=d("I64"))).equal(b.backupId,a)){l("DEVICE_NOT_ONBOARDED_BACKUP_ID_MISMATCH");return 4}l("DEVICE_ONBOARDED");return 3}function a(a){var b=a.clientStateData;a=a.encryptedBackupData;if(a==null)return 0;var e=d("MWEncryptedBackupsFirstRestoreUpsellTime").getFirstRestoreUpsellTime();c("QPLUserFlow").getActiveFlowIDs().includes((j||(j=d("QPLEvent"))).getMarkerId(d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent))||c("QPLUserFlow").start(d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent,{annotations:{string:{ebSessionIdentifier:e,processBackupIdsVersion:"JS",sessionTabId:d("WebSession").getId()}}});if((h||(h=d("I64"))).equal(a.authorityLevel,(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").OPTIMISTIC))){l("FETCH_IN_PROGRESS");return 1}else if((h||(h=d("I64"))).equal(a.authorityLevel,(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE)))return m({clientStateData:b,encryptedBackupData:a});else{d("MWChatEncryptedBackupsLogging").endFailure({errorName:"FETCH_ERROR_WRONG_AUTHORITY_LEVEL",event:d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent});return-1}}g["default"]=a}),98);
__d("useMWChatDisplayEncryptedBackupsRestoreToast",["I64","LSEncryptedBackupsClientRestoreState","LSIntEnum","ReQL","ReQLSuspense","react","react-compiler-runtime","useMAWEncryptedBackupsRestoreToast","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;b=k||d("react");var l=b.useEffect,m=b.useState;function a(){var a=d("react-compiler-runtime").c(10),b=(h||(h=c("useReStore")))(),e;a[0]!==b.tables.encrypted_backups_client_restore_status?(e=function(){return d("ReQL").fromTableAscending(b.tables.encrypted_backups_client_restore_status)},a[0]=b.tables.encrypted_backups_client_restore_status,a[1]=e):e=a[1];var g;a[2]!==b?(g=[b],a[2]=b,a[3]=g):g=a[3];var i=d("ReQLSuspense").useArray(e,g,f.id+":27");e=c("useMAWEncryptedBackupsRestoreToast")();var j=e.showInProgressToast,k=e.showSuccessToast;g=m(!1);var o=g[0],p=g[1];a[4]!==o||a[5]!==i||a[6]!==j||a[7]!==k?(e=function(){var a=i.some(n);o&&!a?(p(!1),k()):!o&&a&&(p(!0),j())},g=[o,i,j,k],a[4]=o,a[5]=i,a[6]=j,a[7]=k,a[8]=e,a[9]=g):(e=a[8],g=a[9]);l(e,g)}function n(a){a=a.restoreStatus;return a!=null&&(i||(i=d("I64"))).equal(a,(j||(j=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsClientRestoreState").RESTORE_IN_PROGRESS))}g["default"]=a}),98);
__d("useMWChatEncryptedBackupsAutoRestore",["I64","LSAuthorityLevel","LSIntEnum","MWChatEncryptedBackupsAddDeviceWithEBKeys","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsQPLSource.enum","MWEBEntrypointsKillswitch.enum","MWEBODSEntityName.enum","MWEBUseLocalStorage","MWEncryptedBackupsDeviceRegistrationId","MWEncryptedBackupsFirstRestoreUpsellTime","MWEncryptedBackupsLocalStorageEntryEnum","MWEncryptedBackupsSharedState","ReQL","ReQLSuspense","react","react-compiler-runtime","useLabyrinthLogging","useMWEBBackupState","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;b=k||d("react");var l=b.useEffect,m=b.useRef,n=b.useState;function a(){var a=d("react-compiler-runtime").c(21),b=c("MWChatEncryptedBackupsQPLSource.enum").AUTO_RESTORE,e=n(!0),g=e[0],i=e[1],j=(h||(h=c("useReStore")))();e=d("useLabyrinthLogging").useLabyrinthLoggingFlow();var k=e.startFlow,p;a[0]!==g||a[1]!==j?(e=function(){return g?d("ReQL").fromTableAscending(j.tables.secure_encrypted_backups_epochs):d("ReQL").empty()},p=[g,j],a[0]=g,a[1]=j,a[2]=e,a[3]=p):(e=a[2],p=a[3]);var q=d("ReQLSuspense").useFirst(e,p,f.id+":42");a[4]!==g||a[5]!==j?(e=function(){return g?d("ReQL").fromTableAscending(j.tables.secure_encrypted_backups_client_state).filter(o):d("ReQL").empty()},p=[g,j],a[4]=g,a[5]=j,a[6]=e,a[7]=p):(e=a[6],p=a[7]);var r=d("ReQLSuspense").useFirst(e,p,f.id+":49");a[8]===Symbol["for"]("react.memo_cache_sentinel")?(e={entrypoint:c("MWEBEntrypointsKillswitch.enum").AUTO_RESTORE},a[8]=e):e=a[8];var s=c("useMWEBBackupState")(e);a[9]!==g||a[10]!==j?(p=function(){return g?d("ReQL").fromTableAscending(j.tables.experiences_shared_state):d("ReQL").empty()},e=[g,j],a[9]=g,a[10]=j,a[11]=p,a[12]=e):(p=a[11],e=a[12]);var t=d("ReQLSuspense").useArray(p,e,f.id+":66"),u=m(!1);a[13]!==s||a[14]!==r||a[15]!==q||a[16]!==t||a[17]!==k||a[18]!==j?(p=function(){if(u.current||s===1||s===0)return;if(s===3){var a=r==null?void 0:r.deviceId,e=d("MWEncryptedBackupsSharedState").getIsEntryPresentInSharedState({db:j,sharedStateTable:t,stateKey:"auto_restored"}),f=d("MWEncryptedBackupsSharedState").getIsEntryPresentInSharedState({db:j,sharedStateTable:t,stateKey:c("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_RESTORED_SUCCESSFULLY}),g=d("MWEncryptedBackupsSharedState").getIsEntryPresentInSharedState({db:j,sharedStateTable:t,stateKey:c("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_ONBOARDED_SUCCESSFULLY});e=e||f||g;f=d("MWEncryptedBackupsDeviceRegistrationId").getDeviceRegistrationId();if(!e&&f!==""&&r!=null&&q!=null&&a!=null){d("MWEBUseLocalStorage").mwEBCreateLocalStorageEntry(c("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_REMEMBER_BROWSER_CONSENT);k({additionalAnnotations:{device_type:"auto_restore"},event:d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_AUTO_RESTORE_AUTH,source:b});g=d("MWEncryptedBackupsFirstRestoreUpsellTime").getFirstRestoreUpsellTime();k({additionalAnnotations:{eb_session_identifier:g,restore_upsell_first_impression_time:g},event:d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,source:b});e={backupId:r.backupId,db:j,newDeviceRegistrationId:f,previousDeviceId:a};d("MWChatEncryptedBackupsAddDeviceWithEBKeys").addDeviceWithEBKeys(e)}}u.current=!0;i(!1)},e=[s,r,q,t,b,k,j],a[13]=s,a[14]=r,a[15]=q,a[16]=t,a[17]=k,a[18]=j,a[19]=p,a[20]=e):(p=a[19],e=a[20]);l(p,e)}function o(a){a=a.authorityLevel;return(i||(i=d("I64"))).equal(a,(j||(j=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))}g["default"]=a}),98);
__d("useMWEBListenForChangesToBackupStateXDevice",["I64","ReQL","ReQLSuspense","react","react-compiler-runtime","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;b=j||d("react");var k=b.useEffect,l=b.useRef;function a(a){var b=d("react-compiler-runtime").c(8),e=(h||(h=c("useReStore")))(),g;b[0]!==e.tables.encrypted_backups_status_trigger?(g=function(){return d("ReQL").fromTableAscending(e.tables.encrypted_backups_status_trigger)},b[0]=e.tables.encrypted_backups_status_trigger,b[1]=g):g=b[1];var j;b[2]!==e?(j=[e],b[2]=e,b[3]=j):j=b[3];var m=d("ReQLSuspense").useFirst(g,j,f.id+":27"),n=l(null);b[4]!==m||b[5]!==a?(g=function(){m!=null&&n.current!==m.pk&&!(i||(i=d("I64"))).equal(m.pk,(i||(i=d("I64"))).of_float(0))&&(n.current=m.pk,a())},j=[m,a],b[4]=m,b[5]=a,b[6]=g,b[7]=j):(g=b[6],j=b[7]);k(g,j)}g["default"]=a}),98);
__d("useMWEBPropagateEbStateChangesThroughRelay",["CometRelay","EBLogger","MAWStateContext.react","ReQL","ReQLSuspense","gkx","promiseDone","react","requireDeferred","useMAWHasUserVisibleErrors","useMAWUnsupportedBrowserNUX","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;b=k||d("react");var l=b.useCallback,m=b.useEffect,n=b.useRef,o=c("requireDeferred")("mwEBSetBackupState").__setRef("useMWEBPropagateEbStateChangesThroughRelay"),p=c("requireDeferred")("mwProcessBackupIds").__setRef("useMWEBPropagateEbStateChangesThroughRelay"),q=c("gkx")("12414");function a(a){var b=a.listenForChangesToBackupState,e=a.onStateChange,g=(j||(j=c("useReStore")))(),k=d("CometRelay").useRelayEnvironment(),r=d("ReQLSuspense").useFirst(function(){return b&&!q?d("ReQL").fromTableAscending(g.tables.encrypted_backups):d("ReQL").empty()},[g,b],f.id+":47"),s=d("ReQLSuspense").useFirst(function(){return b&&!q?d("ReQL").fromTableAscending(g.tables.secure_encrypted_backups_client_state):d("ReQL").empty()},[g,b],f.id+":54"),t=d("MAWStateContext.react").useMAWSelector(function(a){return q?a.ebState:null}),u=n(null),v=l(function(a){d("EBLogger").EBLogger.DEBUG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[useMWEBPropagateEbStateChangesThroughRelay] update: ",""])),a);var b=u.current;b!==null&&b!==a&&e&&(d("EBLogger").EBLogger.DEBUG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["mwEB Backup state changed from "," to "," - triggering onStateChange"])),b,a),e());u.current=a;d("CometRelay").commitLocalUpdate(k,function(b){b=b.getRoot().getLinkedRecord("viewer");if(b==null){d("EBLogger").EBLogger.mustfix("[backup_state] A viewer record does not exist when propagating EB state.");return}b.setValue(a,"backup_state")})},[k,e]);a=d("useMAWUnsupportedBrowserNUX").useMAWUnsupportedBrowserNUX();a=a.shouldHideEBFlow;var w=c("useMAWHasUserVisibleErrors")(),x=a||w;m(function(){async function a(){var a=t;a==null&&((r!=null||s!=null)&&(a=x?0:(await p.load())({clientStateData:s,encryptedBackupData:r})));a!=null&&(await o.load())({setBackupState:v,state:a})}c("promiseDone")(a())},[s,g,r,k,x,v,t])}g.default=a}),98);
__d("useMWEncryptedBackupsFetchBackupIdsV2ImplQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="23961239003493663"}),null);
__d("useMWEncryptedBackupsFetchBackupIdsV2ImplQuery.graphql",["useMWEncryptedBackupsFetchBackupIdsV2ImplQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null};return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"useMWEncryptedBackupsFetchBackupIdsV2ImplQuery",selections:[{args:null,kind:"FragmentSpread",name:"useMWEncryptedBackupsFetchBackupIdsV2Impl_query"}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"useMWEncryptedBackupsFetchBackupIdsV2ImplQuery",selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"xfb_backup",plural:!1,selections:[a,{alias:null,args:null,kind:"ScalarField",name:"backup_tenancy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_user_opted_out",storageKey:null},{alias:null,args:[{kind:"Literal",name:"family_device_id",value:""}],kind:"ScalarField",name:"has_otc_eligible_devices",storageKey:'has_otc_eligible_devices(family_device_id:"")'},{alias:null,args:null,kind:"ScalarField",name:"encryption_management_delegator_id",storageKey:null},{alias:null,args:null,concreteType:"XFBEBVirtualDevice",kind:"LinkedField",name:"virtual_devices",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"client_generated_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_created_on",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"creation_time",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"migration_status",storageKey:null},a],storageKey:null},{alias:null,args:null,concreteType:"XFBEncryptedBackupDevicesConnection",kind:"LinkedField",name:"devices",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupDevicesEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"XFBEBDevice",kind:"LinkedField",name:"node",plural:!1,selections:[a],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEBUserPreferences",kind:"LinkedField",name:"xfb_eb_user_preferences",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"onboarding_decision",storageKey:null},a],storageKey:null}]},params:{id:b("useMWEncryptedBackupsFetchBackupIdsV2ImplQuery_facebookRelayOperation"),metadata:{},name:"useMWEncryptedBackupsFetchBackupIdsV2ImplQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("useMWEncryptedBackupsFetchBackupIdsV2Impl_query.graphql",["useMWEncryptedBackupsFetchBackupIdsV2ImplQuery.graphql"],(function(a,b,c,d,e,f){"use strict";a=function(){var a={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null};return{argumentDefinitions:[],kind:"Fragment",metadata:{refetch:{connection:null,fragmentPathInResult:[],operation:b("useMWEncryptedBackupsFetchBackupIdsV2ImplQuery.graphql")}},name:"useMWEncryptedBackupsFetchBackupIdsV2Impl_query",selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"xfb_backup",plural:!1,selections:[a,{alias:null,args:null,kind:"ScalarField",name:"backup_tenancy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_user_opted_out",storageKey:null},{alias:null,args:[{kind:"Literal",name:"family_device_id",value:""}],kind:"ScalarField",name:"has_otc_eligible_devices",storageKey:'has_otc_eligible_devices(family_device_id:"")'},{alias:null,args:null,kind:"ScalarField",name:"encryption_management_delegator_id",storageKey:null},{alias:null,args:null,concreteType:"XFBEBVirtualDevice",kind:"LinkedField",name:"virtual_devices",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"client_generated_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_created_on",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"creation_time",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"migration_status",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEncryptedBackupDevicesConnection",kind:"LinkedField",name:"devices",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupDevicesEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"XFBEBDevice",kind:"LinkedField",name:"node",plural:!1,selections:[a],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEBUserPreferences",kind:"LinkedField",name:"xfb_eb_user_preferences",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"onboarding_decision",storageKey:null}],storageKey:null}],type:"Query",abstractKey:null}}();e.exports=a}),null);
__d("useMWEncryptedBackupsFetchBackupIdsV2Query_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="29473760965600491"}),null);
__d("useMWEncryptedBackupsFetchBackupIdsV2Query.graphql",["useMWEncryptedBackupsFetchBackupIdsV2Query_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null};return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"useMWEncryptedBackupsFetchBackupIdsV2Query",selections:[{args:null,kind:"FragmentSpread",name:"useMWEncryptedBackupsFetchBackupIdsV2Impl_query"}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"useMWEncryptedBackupsFetchBackupIdsV2Query",selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"xfb_backup",plural:!1,selections:[a,{alias:null,args:null,kind:"ScalarField",name:"backup_tenancy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_user_opted_out",storageKey:null},{alias:null,args:[{kind:"Literal",name:"family_device_id",value:""}],kind:"ScalarField",name:"has_otc_eligible_devices",storageKey:'has_otc_eligible_devices(family_device_id:"")'},{alias:null,args:null,kind:"ScalarField",name:"encryption_management_delegator_id",storageKey:null},{alias:null,args:null,concreteType:"XFBEBVirtualDevice",kind:"LinkedField",name:"virtual_devices",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"client_generated_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_created_on",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"creation_time",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"migration_status",storageKey:null},a],storageKey:null},{alias:null,args:null,concreteType:"XFBEncryptedBackupDevicesConnection",kind:"LinkedField",name:"devices",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupDevicesEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"XFBEBDevice",kind:"LinkedField",name:"node",plural:!1,selections:[a],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEBUserPreferences",kind:"LinkedField",name:"xfb_eb_user_preferences",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"onboarding_decision",storageKey:null},a],storageKey:null}]},params:{id:b("useMWEncryptedBackupsFetchBackupIdsV2Query_facebookRelayOperation"),metadata:{},name:"useMWEncryptedBackupsFetchBackupIdsV2Query",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("useMWEncryptedBackupsFetchBackupIdsV2",["Base64Utils","CometRelay","FBLogger","I64","LSEncryptedBackupsBackupTenancy","LSEncryptedBackupsOnboardingDecision","LSEncryptedBackupsVirtualDeviceType","LSIntEnum","LSShape","LSVec","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWEncryptedBackupsFirstRestoreUpsellTime","MWEncryptedBackupsListenForChangesToBackupStateInitPath","Promise","QPLEvent","QPLUserFlow","WebSession","cr:6666","promiseDone","react","react-compiler-runtime","requireDeferred","useAsyncReStore","useMWEBListenForChangesToBackupStateXDevice","useMWEBPropagateEbStateChangesThroughRelay","useMWEncryptedBackupsFetchBackupIdsV2Impl_query.graphql","useMWEncryptedBackupsFetchBackupIdsV2Query.graphql"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n;e=k||d("react");var o=e.useEffect,p=e.useRef,q=e.useState,r=c("requireDeferred")("mwEBUpdateBackupsTable").__setRef("useMWEncryptedBackupsFetchBackupIdsV2");function s(a){if(a!=null){a=a;a=c("LSEncryptedBackupsOnboardingDecision")[a];return a}return void 0}function t(a){if(a!=null){a=a;a=c("LSEncryptedBackupsBackupTenancy")[a];return(l||(l=d("LSIntEnum"))).ofNumber(a)}return void 0}function u(a){var e=a.data,f=a.dbPromise,g=a.isInitalLoad,h=a.setListenForChangesToBackupState,i=e.xfb_backup,k=i==null?void 0:i.id;if(i!=null&&k!=null){g.current===!0&&b("cr:6666")!=null&&c("promiseDone")(b("cr:6666")(f));var m=!1;(i==null?void 0:i.has_otc_eligible_devices)!=null?m=i==null?void 0:i.has_otc_eligible_devices:c("FBLogger")("labyrinth_web").mustfix("failed to retrieve has_otc_eligible_devices. defaulting to false");var o=c("LSVec").ofArray([d("LSShape").ofRecord({backup_id:(n||(n=d("I64"))).of_string(k),backup_tenancy:t(i.backup_tenancy)})]),p=[];i.virtual_devices.forEach(function(a){var b,e=a.client_generated_id;if(k==null||e==null||a.device_type==null){c("FBLogger")("labyrinth_web").warn("Invalid virtual device fetched in fetchBackupsIdsV2.");return}var f="REQUIRES_MIGRATION";f=a.migration_status===f;var g=a.device_type;g=c("LSEncryptedBackupsVirtualDeviceType")[g];p.push(d("LSShape").ofRecord({backup_id:(n||(n=d("I64"))).of_string(k),virtual_device_ids:c("LSVec").ofArray([d("LSShape").ofRecord({virtual_device_id:d("Base64Utils").toArrayBuffer(e)})]),virtual_devices:c("LSVec").ofArray([d("LSShape").ofRecord({creation_time:(b=a.creation_time)!=null?b:void 0,device_created_on:(b=a.device_created_on)!=null?b:void 0,requires_hsm_migration:f,virtual_device_id:d("Base64Utils").toArrayBuffer(e),virtual_device_type:(l||(l=d("LSIntEnum"))).ofNumber(g)})])}))});var q=[];(a=i.devices)==null||a.edges.forEach(function(a){var b;if(((b=a.node)==null?void 0:b.id)==null)return;q.push(d("LSShape").ofRecord({device_id:(n||(n=d("I64"))).of_string((b=a.node)==null?void 0:b.id)}))});var u=i.encryption_management_delegator_id!=null?(n||(n=d("I64"))).of_string(i.encryption_management_delegator_id):void 0;c("promiseDone")((j||(j=b("Promise"))).all([r.load(),f]),function(a){var b=a[0],d=a[1];c("promiseDone")(b({backupIds:o,deviceIds:c("LSVec").ofArray(q),encryptionManagementDelegatorId:u,hasOtcEligibleDevices:m,isSuccess:!0,isUserOptedOut:(a=i.is_user_opted_out)!=null?a:void 0,storage:d,virtualDevices:c("LSVec").ofArray(p)}),function(){h(!0),g.current===!0&&(g.current=!1,c("MWEncryptedBackupsListenForChangesToBackupStateInitPath").preloadEBData(d))})})}else{var v=s((a=e.xfb_eb_user_preferences)==null?void 0:a.onboarding_decision)===c("LSEncryptedBackupsOnboardingDecision").STORE_ON_DEVICE_ONLY;c("promiseDone")((j||(j=b("Promise"))).all([r.load(),f]),function(a){var b=a[0];a=a[1];c("promiseDone")(b({backupIds:c("LSVec").ofArray([]),deviceIds:c("LSVec").ofArray([]),hasOtcEligibleDevices:!1,isSuccess:!0,isUserOptedOut:v,storage:a,virtualDevices:c("LSVec").ofArray([])}),function(){h(!0)})})}}function v(a){var e=d("react-compiler-runtime").c(10),f=c("useAsyncReStore")(),g=p(!0),i=p(!1),j=q(!1),k=j[0],l=j[1];j=d("CometRelay").useRefetchableFragment(h!==void 0?h:h=b("useMWEncryptedBackupsFetchBackupIdsV2Impl_query.graphql"),a);var n=j[0],r=j[1];e[0]!==n||e[1]!==r?(a=function(){var a=d("MWEncryptedBackupsFirstRestoreUpsellTime").getFirstRestoreUpsellTime();c("QPLUserFlow").getActiveFlowIDs().includes((m||(m=d("QPLEvent"))).getMarkerId(d("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent))||c("QPLUserFlow").start(d("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent,{annotations:{string:{ebSessionIdentifier:a,fetchBackupIdsVersion:"GQL",sessionTabId:d("WebSession").getId()}}});r({},{fetchPolicy:"network-only",onComplete:function(a){i.current=!1;if(c("QPLUserFlow").getActiveFlowIDs().includes((m||(m=d("QPLEvent"))).getMarkerId(d("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent)))if(a!=null)d("MWChatEncryptedBackupsLogging").endFailure({annotations:{string:{error:a.message,error_stack:a.stack}},errorName:"fetch_backup_ids_error",event:d("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent});else{d("MWChatEncryptedBackupsLogging").endSuccess({annotations:{bool:{isUserOptedOut:(a=n.xfb_backup)==null?void 0:a.is_user_opted_out},string:{backup_id:(a=(a=n.xfb_backup)==null?void 0:a.id)!=null?a:"null"}},event:d("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent})}}})},e[0]=n,e[1]=r,e[2]=a):a=e[2];j=a;c("useMWEBListenForChangesToBackupStateXDevice")(j);e[3]!==k||e[4]!==j?(a={listenForChangesToBackupState:k,onStateChange:j},e[3]=k,e[4]=j,e[5]=a):a=e[5];c("useMWEBPropagateEbStateChangesThroughRelay")(a);e[6]!==n||e[7]!==f?(k=function(){if(i.current===!0)return;i.current=!0;u({data:n,dbPromise:f,isInitalLoad:g,setListenForChangesToBackupState:l})},j=[n,f],e[6]=n,e[7]=f,e[8]=k,e[9]=j):(k=e[8],j=e[9]);o(k,j)}function a(){var a=d("CometRelay").useLazyLoadQuery(i!==void 0?i:i=b("useMWEncryptedBackupsFetchBackupIdsV2Query.graphql"),{},{fetchPolicy:"network-only"});v(a)}g["default"]=a}),98);