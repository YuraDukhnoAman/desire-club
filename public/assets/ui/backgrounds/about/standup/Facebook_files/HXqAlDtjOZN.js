;/*FB_PKG_DELIM*/

__d("LSHandleFTSIndexProtobufMessageResponse",["LSArrayGetObjectAt","LSDecryptMessageProtobufs","LSIsEncryptionVersionSecure","LSLogMebClientEvent.nop","LSRestoreProtobufs.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][handleFTSIndexProtobufMessageResponse] Beginning execution."),d[1]=c.i64.of_float(Date.now()),d[2]=new c.Map(),d[3]=new c.Map(),c.storedProcedure(b("LSDecryptMessageProtobufs"),a[0],a[2]).then(function(a){return a=a,d[4]=a[0],d[5]=a[1],a})},function(e){return d[6]=a[3].get("restore_task_source"),d[7]=a[3].get("request_id"),c.i64.neq(a[4],void 0)?c.sequence([function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[21]=new c.Map(),d[21].set("error_msg","Expected a nonempty query result"),d[21].set("code",c.i64.cast([0,3])),d[21].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[22]=c.createArray(),d[23]=(d[22].push(d[21]),d[22]),e=[void 0,d[22]],d[15]=e[0],d[16]=e[1]):(b=a.item,d[21]=new c.Map(),d[21].set("backup_id",b.backupId),d[21].set("device_public_key_blob",b.devicePublicKeyBlob),d[21].set("device_private_key_blob",b.devicePrivateKeyBlob),d[21].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[21].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[21].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[21].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[21].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[21].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[21].set("orf_client_state_v2_blob",void 0),d[21].set("orf_v2_authority_level",void 0),d[21].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[21].set("device_id",b.deviceId),d[21].set("backup_tenancy",b.backupTenancy),d[21].set("encryption_version",b.encryptionVersion),d[21].set("revision_version",b.revisionVersion),d[21].set("initialize_restore_result",void 0),d[21].set("device_creation_timestamp_sec",void 0),d[21].set("authority_level",b.authorityLevel),e=[d[21],void 0],d[15]=e[0],d[16]=e[1])})},function(e){return d[18]=new c.Map(),d[18].set("value",d[15]),d[18].set("errors",d[16]),d[19]=d[18].get("value"),d[19]!==void 0?c.sequence([function(e){return d[21]=d[19].get("backup_id"),d[22]=d[19].get("device_public_key_blob"),d[23]=d[19].get("device_private_key_blob"),d[24]=d[19].get("epoch_storage_public_key_blob"),d[25]=d[19].get("epoch_storage_private_key_blob"),d[26]=d[19].get("epoch_auth_public_key_blob"),d[27]=d[19].get("epoch_auth_private_key_blob"),d[28]=d[19].get("mailbox_root_key_blob"),d[29]=d[19].get("ocmf_client_state_blob"),d[30]=d[19].get("orf_client_state_v2_blob"),d[31]=d[19].get("orf_v2_authority_level"),d[32]=d[19].get("oblivious_validation_token_blob"),d[33]=d[19].get("device_id"),d[34]=d[19].get("backup_tenancy"),d[35]=d[19].get("encryption_version"),d[36]=d[19].get("revision_version"),d[37]=d[19].get("initialize_restore_result"),d[38]=d[19].get("device_creation_timestamp_sec"),d[39]=d[19].get("authority_level"),c.i64.neq(d[33],void 0)?c.sequence([function(a){return d[41]=void 0,c.i64.neq(d[41],void 0)?c.resolve(d[42]=d[41]):c.sequence([function(a){return d[45]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[46]=a[0],a})},function(a){return d[46]?d[55]=(d[45].push(c.i64.cast([0,0])),d[45]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[47]=a[0],a})},function(a){return d[47]?d[55]=(d[45].push(c.i64.cast([0,2])),d[45]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[48]=a[0],a})},function(a){return d[48]?d[55]=(d[45].push(c.i64.cast([0,3])),d[45]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[49]=a[0],a})},function(a){return d[49]?d[55]=(d[45].push(c.i64.cast([0,4])),d[45]):0,d[50]=c.createArray(),d[51]=c.i64.of_int32(d[45].length),c.i64.gt(d[51],c.i64.cast([0,0]))?c.loopAsync(d[51],function(a){return d[55]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[45],d[55]).then(function(a){return a=a,d[56]=a[0],d[57]=a[1],a})},function(a){return d[58]=(d[50].push(d[56]),d[50])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[55]=c.createArray(),d[56]=c.i64.of_int32(d[50].length),c.i64.gt(d[56],c.i64.cast([0,0]))?c.loopAsync(d[56],function(a){return d[58]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[50],d[58]).then(function(a){return a=a,d[59]=a[0],d[60]=a[1],a})},function(a){return d[61]=(d[55].push(c.i64.to_string(d[59])),d[55])}])}):c.resolve()},function(a){return d[57]=d[55].join(","),d[52]=d[57]}])},function(a){return d[50].some(function(a){return c.i64.eq(d[35],a)})?d[53]=d[35]:d[53]=void 0,c.i64.neq(d[53],void 0)?d[54]=d[53]:d[54]=void 0,d[42]=d[54]}])},function(b){return c.i64.neq(d[42],void 0)?d[43]=d[42]:d[43]=c.i64.cast([0,0]),c.i64.neq(d[34],void 0)?d[44]=d[34]:d[44]=c.i64.cast([0,1]),d[40]=c.i64.neq(d[33],a[4])}]):c.resolve(d[40]=!1)},function(a){return d[20]=d[40]}]):c.resolve((d[21]=d[18].get("errors"),d[22]=d[18].get("errors"),d[20]=!1))},function(a){return d[8]=d[20]}]):c.resolve(d[8]=!1)},function(e){return d[8]?c.resolve(0):c.sequence([function(e){return d[4]!==void 0?c.sequence([function(e){return d[16]=a[1].get("has_more_before"),d[17]=a[1].get("has_more_after"),d[16]?(d[25]=a[1].get("next_message_timestamp_ms_before"),d[18]=d[25]):d[18]=void 0,d[17]?(d[25]=a[1].get("next_message_timestamp_ms_after"),d[19]=d[25]):d[19]=void 0,d[20]=a[1].get("has_more_before"),d[21]=a[1].get("has_more_after"),d[22]=a[3].get("request_id"),d[23]=a[3].get("reference_timestamp"),d[24]=c.createArray(),c.nativeOperation(b("LSRestoreProtobufs.nop"),a[2],d[4],d[20],d[18],d[21],d[19],!1,d[22],d[23],a[5],d[24],d[6],void 0)},function(a){return d[15]=void 0}]):c.resolve((d[5]!==void 0?(d[16]=d[5].get("error_code"),c.i64.eq(d[16],c.i64.cast([0,1]))?0:0):0,d[15]=d[5]))},function(e){return d[15]!==void 0?c.sequence([function(b){return d[16]=a[3].get("request_id"),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[24]=new c.Map(),d[24].set("error_msg","Expected a nonempty query result"),d[24].set("code",c.i64.cast([0,3])),d[24].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[25]=c.createArray(),d[26]=(d[25].push(d[24]),d[25]),e=[void 0,d[25]],d[17]=e[0],d[18]=e[1]):(b=a.item,d[24]=new c.Map(),d[24].set("backup_id",b.backupId),d[24].set("device_public_key_blob",b.devicePublicKeyBlob),d[24].set("device_private_key_blob",b.devicePrivateKeyBlob),d[24].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[24].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[24].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[24].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[24].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[24].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[24].set("orf_client_state_v2_blob",void 0),d[24].set("orf_v2_authority_level",void 0),d[24].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[24].set("device_id",b.deviceId),d[24].set("backup_tenancy",b.backupTenancy),d[24].set("encryption_version",b.encryptionVersion),d[24].set("revision_version",b.revisionVersion),d[24].set("initialize_restore_result",void 0),d[24].set("device_creation_timestamp_sec",void 0),d[24].set("authority_level",b.authorityLevel),e=[d[24],void 0],d[17]=e[0],d[18]=e[1])})},function(a){return d[20]=new c.Map(),d[20].set("value",d[17]),d[20].set("errors",d[18]),d[21]=d[20].get("value"),d[21]!==void 0?c.sequence([function(a){return d[24]=d[21].get("backup_id"),d[25]=d[21].get("device_public_key_blob"),d[26]=d[21].get("device_private_key_blob"),d[27]=d[21].get("epoch_storage_public_key_blob"),d[28]=d[21].get("epoch_storage_private_key_blob"),d[29]=d[21].get("epoch_auth_public_key_blob"),d[30]=d[21].get("epoch_auth_private_key_blob"),d[31]=d[21].get("mailbox_root_key_blob"),d[32]=d[21].get("ocmf_client_state_blob"),d[33]=d[21].get("orf_client_state_v2_blob"),d[34]=d[21].get("orf_v2_authority_level"),d[35]=d[21].get("oblivious_validation_token_blob"),d[36]=d[21].get("device_id"),d[37]=d[21].get("backup_tenancy"),d[38]=d[21].get("encryption_version"),d[39]=d[21].get("revision_version"),d[40]=d[21].get("initialize_restore_result"),d[41]=d[21].get("device_creation_timestamp_sec"),d[42]=d[21].get("authority_level"),c.i64.neq(d[36],void 0)?c.sequence([function(a){return d[44]=void 0,c.i64.neq(d[44],void 0)?c.resolve(d[45]=d[44]):c.sequence([function(a){return d[48]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[49]=a[0],a})},function(a){return d[49]?d[58]=(d[48].push(c.i64.cast([0,0])),d[48]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[50]=a[0],a})},function(a){return d[50]?d[58]=(d[48].push(c.i64.cast([0,2])),d[48]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[51]=a[0],a})},function(a){return d[51]?d[58]=(d[48].push(c.i64.cast([0,3])),d[48]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[52]=a[0],a})},function(a){return d[52]?d[58]=(d[48].push(c.i64.cast([0,4])),d[48]):0,d[53]=c.createArray(),d[54]=c.i64.of_int32(d[48].length),c.i64.gt(d[54],c.i64.cast([0,0]))?c.loopAsync(d[54],function(a){return d[58]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[48],d[58]).then(function(a){return a=a,d[59]=a[0],d[60]=a[1],a})},function(a){return d[61]=(d[53].push(d[59]),d[53])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[58]=c.createArray(),d[59]=c.i64.of_int32(d[53].length),c.i64.gt(d[59],c.i64.cast([0,0]))?c.loopAsync(d[59],function(a){return d[61]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[53],d[61]).then(function(a){return a=a,d[62]=a[0],d[63]=a[1],a})},function(a){return d[64]=(d[58].push(c.i64.to_string(d[62])),d[58])}])}):c.resolve()},function(a){return d[60]=d[58].join(","),d[55]=d[60]}])},function(a){return d[53].some(function(a){return c.i64.eq(d[38],a)})?d[56]=d[38]:d[56]=void 0,c.i64.neq(d[56],void 0)?d[57]=d[56]:d[57]=void 0,d[45]=d[57]}])},function(a){return c.i64.neq(d[45],void 0)?d[46]=d[45]:d[46]=c.i64.cast([0,0]),c.i64.neq(d[37],void 0)?d[47]=d[37]:d[47]=c.i64.cast([0,1]),d[43]=d[36]}]):c.resolve(d[43]=void 0)},function(a){return d[22]=d[43]}]):c.resolve((d[24]=d[20].get("errors"),d[25]=d[20].get("errors"),d[22]=void 0))},function(b){return d[23]=a[3].get("restore_task_source")}]):c.resolve()}])},function(a){return d[9]=c.i64.of_float(Date.now()),d[10]=c.i64.random(),d[12]="Finishing execution. Execution time: ",d[13]=c.i64.to_string(c.i64.sub(d[9],d[0])),d[14]=" ms",d[11]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][handleFTSIndexProtobufMessageResponse] ",d[11],d[12],d[11],d[13],d[11],d[14]].join("")),c.i64.eq(c.i64.mod_(d[10],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[15]=",",d[16]=c.createArray(),void 0!==void 0?d[17]=(d[16].push(void 0),d[16]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"handleFTSIndexProtobufMessageResponse",[d[12],d[15],d[13],d[15],d[14]].join(""),d[16],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsHandleFTSIndexProtobufMessageResponseStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state"];e.exports=a}),null);